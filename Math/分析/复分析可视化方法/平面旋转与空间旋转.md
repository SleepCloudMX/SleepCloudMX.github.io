<h1 align="center">平面旋转与空间旋转</h1>

$$
\nonumber
% 设置
\newcommand{\aneg}[1]{\hspace{-0.75em}&#1&\hspace{-0.75em}}
\newcommand{\aneq}{\aneg{=}}
% 上述指令用于在使用 array 环境时调整等号左右间距
\newcommand{\eqs}{\quad\;}
% 上述指令用于 align 环境中, &= 的换行对齐时调整第二行位置
\renewcommand{\d}{\displaystyle}

% 字符
\renewcommand{\i}{\mathrm{i}}
\renewcommand{\j}{\mathrm{j}}
\renewcommand{\k}{\mathrm{k}}
\newcommand{\e}{\textup{e}}
\newcommand{\ve}{\varepsilon}
\newcommand{\Beta}{\mathit{B}}
\newcommand{\omicron}{\mathit{o}}
\newcommand{\Omicron}{\mathit{O}}

% 原本的定义为:
% \newcommand{\cal}[1]{\mathcal{#1}}
\newcommand{\bm}[1]{\boldsymbol{#1}}
\renewcommand{\cal}[1]{\mathcal#1}
\renewcommand{\scr}[1]{\mathscr#1}
\renewcommand{\frak}[1]{\mathfrak#1}
\newcommand{\bb}[1]{\mathbb#1}

% 数集
\newcommand{\D}{\mathbb{D}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\J}{\mathbb{J}}
\newcommand{\K}{\mathbb{K}}
\renewcommand{\L}{\mathbb{L}}

% 上下标
\newcommand{\trans}{^\mathrm{T}}
\newcommand{\inv}{^{-1}}
\newcommand{\madj}[1]{^{\pqty{#1^*}}}	% m 重伴随矩阵
\newcommand{\adj}{^*}
\newcommand{\vector}[1]{\overrightarrow{#1}}
\newcommand{\wavy}[1]{\overset\sim#1}	% \tilde 或 \widetilde 不明显, 容易与 \bar 或 \overline 混淆

% 序列
\newcommand{\ccdots}{\cdot\cdots\cdot}
\newcommand{\oneton}{1,2,\cdots,n}
\newcommand{\oneto}[1]{1,2,\cdots,#1}

\newcommand{\ssto}[3]{#1_1 #3 #1_2 #3 \cdots #3 #1_{#2}}
\newcommand{\ssup}[3]{#1^1 #3 #1^2 #3 \cdots #3 #1^{#2}}
\newcommand{\soneto}[2]{\ssto{#1}{#2}{,}}
\newcommand{\splus}[2]{\ssto{#1}{#2}{+}}

% 括号
\newcommand{\aqty}[1]{\expval{#1}}
\newcommand{\pbqty}[1]{\left(#1\right]}
\newcommand{\bpqty}[1]{\left[#1\right)}
\newcommand{\floor}[1]{\left\lfloor#1\right\rfloor}
\newcommand{\ceil}[1]{\left\lceil#1\right\rceil}

% 矩阵宏简写
\newcommand{\bmatrix}[1]{\begin{bmatrix}#1\end{bmatrix}}
\newcommand{\Bmatrix}[1]{\begin{Bmatrix}#1\end{Bmatrix}}
\newcommand{\vmatrix}[1]{\begin{vmatrix}#1\end{vmatrix}}
\newcommand{\Vmatrix}[1]{\begin{Vmatrix}#1\end{Vmatrix}}

% 常用微分
\newcommand{\dx}{\dd{x}}
\newcommand{\dy}{\dd{y}}
\newcommand{\dz}{\dd{z}}
\newcommand{\dt}{\dd{t}}
\newcommand{\ds}{\dd{s}}
\newcommand{\dr}{\dd{r}}

% 一般的微分
% 如果只使用 \dd{x}\dd{y} 的话, 中间会有多余的间隔.
\newcommand{\df}{\dd}
\newcommand{\ddf}[2]{\,\mathrm{d}#1\mathrm{d}#2}	% 微分形式 differential form
\newcommand{\dddf}[3]{\,\mathrm{d}#1\mathrm{d}#2\mathrm{d}#3}

% 高阶微分
\newcommand{\dxdy}{\ddf{x}{y}}
\newcommand{\dydz}{\ddf{y}{z}}
\newcommand{\dzdx}{\ddf{z}{x}}
\newcommand{\dudv}{\ddf{u}{v}}
\newcommand{\drdt}{\ddf{r}{\theta}}
\newcommand{\dxdydz}{\dddf{x}{y}{z}}

% 矩阵的宏指令
\newcommand{\pmcmn}[3]{\begin{pmatrix}
	#1_{11} & #1_{12} & \cdots & #1_{1#3} \\
	#1_{21} & #1_{22} & \cdots & #1_{n#3} \\
	\vdots & \vdots && \vdots \\
	#1_{#2 1} & #1_{#2 2} & \cdots & #2_{n#3} \\
\end{pmatrix}}

\newcommand{\pmc}[1]{\pmcmn{#1}{n}{n}}
\newcommand{\pvcn}[2]{\begin{pmatrix}
	#1_1 \\ #1_2 \\ \vdots \\ #1_{#2}
\end{pmatrix}}

\newcommand{\pvc}[1]{\pvcn{#1}{n}}
\newcommand{\pto}{\overset{P}{\to}}

% 函数名
\renewcommand{\char}{\operatorname{char}}	% 由于已存在此命令, 不可使用 DeclareMathOperator
\renewcommand{\r}{\operatorname{r}}
\DeclareMathOperator{\st}{s.t.\,}	% 虽然不是函数名, 但用了这个指令就放这儿了.
\DeclareMathOperator{\diag}{diag}	% 不需要定义太多, 一个文件里用到什么定义什么,
\DeclareMathOperator{\Ker}{Ker}		% 毕竟特殊的函数名太多太多了.
\DeclareMathOperator{\Aut}{Aut}		% 便捷与效率的权衡.
\DeclareMathOperator{\Inn}{Inn}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\SL}{SL}
\DeclareMathOperator{\stab}{stab}
\DeclareMathOperator{\orb}{orb}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\Cov}{Cov}
\DeclareMathOperator{\Corr}{Corr}
\DeclareMathOperator{\rot}{rot}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\Outer}{Outer}
\DeclareMathOperator{\Even}{Even}
\DeclareMathOperator{\Scalar}{Scalar}
\DeclareMathOperator{\Vector}{Vector}
\DeclareMathOperator{\arsh}{arsh}
\DeclareMathOperator{\arch}{arch}
\DeclareMathOperator{\arth}{arth}
\renewcommand{\Re}{\operatorname{Re}}	% 自带 \Re 的效果是 \mathrm{Re}, 前后无空格, 故重写
\renewcommand{\Im}{\operatorname{Im}}
\DeclareMathOperator{\Sa}{Sa}
\DeclareMathOperator{\Si}{Si}

% 运算符
% 可以用 \bigcap, \bigcup, \bigoplus, \bigotimes 替代
\newcommand{\capop}{\displaystyle\mathop\cap\limits}
\newcommand{\cupop}{\displaystyle\mathop\cup\limits}
\newcommand{\oplusop}{\mathop\oplus\limits}
\newcommand{\otimesop}{\mathop\otimes\limits}
\newcommand{\bigoplusop}{\mathop\bigoplus\limits}
\newcommand{\bigotimesop}{\mathop\bigotimes\limits}

% 积分
\newcommand{\dint}{\displaystyle\int}
\newcommand{\inti}{\dint_{-\infty}^{+\infty}}
\newcommand{\intoi}{\dint_0^{+\infty}}

\newcommand{\intl}{\displaystyle\int\limits}
\newcommand{\iintl}{\displaystyle\iint\limits}
\newcommand{\iiintl}{\displaystyle\iiint\limits}

% 求和
\newcommand{\dsum}{\displaystyle\sum}
\newcommand{\csum}[1]{\dsum_{#1=1}^\infty}
\newcommand{\nsum}{\csum{n}}
\newcommand{\ksum}{\csum{k}}
\newcommand{\nosum}{\dsum_{n=0}^\infty}
\newcommand{\insum}{\dsum_{i=1}^n}
\newcommand{\knsum}{\dsum_{k=1}^n}

% 求积
\newcommand{\dprod}{\displaystyle\prod}
\newcommand{\nprod}{\dprod_{n=1}^\infty}
\newcommand{\noprod}{\dprod_{n=0}^\infty}
\newcommand{\inprod}{\dprod_{i=1}^n}

% 极限
\newcommand{\liml}{\lim\limits}
\newcommand{\ulim}{\overline\lim\limits_{n\to\infty}}
\newcommand{\dlim}{\underline\lim\limits_{n\to\infty}}
% 注意这里的 d 是 down, 而不是 displaystyle

\newcommand{\xlim}{\lim\limits_{x\to x_0}}
\newcommand{\nlim}{\lim\limits_{n\to\infty}}
\newcommand{\clim}[1]{\lim\limits_{#1\to\infty}}

% 并集
\newcommand{\incup}{\bigcup_{i=1}^n}
\newcommand{\ncup}{\bigcup_{n=1}^\infty}
\newcommand{\icup}{\bigcup_{i=1}^\infty}

% 交集
\newcommand{\incap}{\bigcap_{i=1}^n}
\newcommand{\ncap}{\bigcap_{n=1}^\infty}
\newcommand{\icap}{\bigcap_{i=1}^\infty}

% 差分
\newcommand{\DD}{\Delta}
\newcommand{\DV}[2]{\dfrac{\DD#1}{\DD#2}}
\newcommand{\nDV}[3]{\dfrac{\DD^{#1}#2}{\DD#3^{#1}}}

% 求导
\newcommand{\ddv}{\displaystyle\dv}
\newcommand{\dpdv}{\displaystyle\pdv}

% 缩写
\newcommand{\LRA}{\Leftrightarrow}
\newcommand{\RLA}{\Leftrightarrow}
\newcommand{\LA}{\Leftarrow}
\newcommand{\RA}{\Rightarrow}

\newcommand{\lra}{\leftrightarrow}
\newcommand{\rla}{\leftrightarrow}
\newcommand{\la}{\leftarrow}
\newcommand{\ra}{\rightarrow}

\newcommand{\QRLA}{\quad\RLA\quad}
\newcommand{\QRA}{\quad\RA\quad}
\newcommand{\LLRA}{\Longleftrightarrow}

\newcommand{\QNRA}{\quad\nRightarrow\quad}
\newcommand{\qnra}{\quad\nrightarrow\quad}

\newcommand{\wt}{\widetilde}

% 图形符号
\newcommand{\qed}{\quad\square}
\renewcommand{\parallel}{\mathrel{/\mskip-2.5mu/}}
\newcommand{\paralleleq}{\hspace{0.5em}{^{^{\parallel}}}\hspace{-1.04em}=}
\newcommand{\rt}{\matrm{Rt}\triangle}

% 分块矩阵
\newenvironment{mat}[1]{
	\begin{array}{#1}
}{
	\end{array}
}

\newenvironment{pmat}[1]{
	\left( \begin{array}{#1}
}{
	\end{array} \right)
}

\newenvironment{bmat}[1]{
	\left[ \begin{array}{#1}
}{
	\end{array} \right]
}

\newenvironment{Bmat}[1]{
	\left\{ \begin{array}{#1}
}{
	\end{array} \right\}
}

\newenvironment{vmat}[1]{
	\left\lvert \begin{array}{#1}
}{
	\end{array} \right\rvert
}

\newenvironment{Vmat}[1]{
	\left\lVert \begin{array}{#1}
}{
	\end{array} \right\rVert
}
$$

[TOC]

## 0	前言

你可能有三角函数的基础，却未曾推导过平面旋转公式；或者熟知平面旋转公式，不过对空间旋转不甚了解；或者知晓空间旋转，却仍无法很好地理解四元数；或者看过四元数的科普视频或文章，但对四元数的由来仍抱有疑惑. 那么这篇文章便是写给你看的；即使熟知四元数，甚至用四元数实现过空间旋转，也可以看看这篇文章，作为思路整理、知识复习和角度拓展.

在这篇文章里，我将分别讨论平面旋转与空间旋转，从历史的角度深入阐释四元数的由来，用简明的语言论证四元数的性质与空间旋转公式，最后比较多种旋转公式的优劣. 本文并不侧重于复数与四元数的可视化，如有需要可以参考 3blue1brown 的视频 ([复数](https://www.bilibili.com/video/BV1fx41187tZ/?spm_id_from=333.999.0.0&vd_source=cc171ffacaec079f01b2a965fd3825f7)，[四元数](https://www.bilibili.com/video/BV1SW411y7W1/?spm_id_from=333.999.0.0&vd_source=cc171ffacaec079f01b2a965fd3825f7))；本文中我们也不会讨论运动的分类，而只着眼于旋转这一情况；

阅读本文需要有高中的数学基础，并了解行列式与矩阵的定义；个别地方用到了抽代的概念，不知道可以跳过，不影响整体的理解；1.3、2.3、2.4 这三节是从我笔记里复制过来的，给没有学过的人看的话易读性可能会比较差（提前谢罪）.



## 1	平面旋转

### 1.1	解析几何

#### 1.1.1	点关于点的旋转

在平面几何中，用直角坐标计算角度是相对繁琐的，参数中含有角度的极坐标更适合求解旋转. 因此我们希望利用极坐标的思路，求解直角坐标系中的旋转公式.

欲求点 $ (x_1, y_1) $ 关于原点顺时针旋转 $ \beta $ 后的坐标，将点表示为
$$
(x_1, y_1) = (r\cos\alpha, r\sin\alpha),
$$
于是旋转后的坐标 $ (x, y) $ 可表示为
$$
\label{1.1.1 点的旋转}
\begin{cases}
	x = r\cos(\alpha + \beta)
	%= r \cos\alpha \cos\beta - r \sin\alpha\sin\beta
	= x_1 \cos\beta - y_1 \sin\beta, \\
	y = r\sin(\alpha + \beta)
	= x_1 \sin\beta + y_1 \cos\beta.
\end{cases}
$$

更一般的，利用平移，点 $ (x_1, y_1) $ 关于点 $ (x_0, y_0) $ 旋转 $ \beta $ 后的坐标可表示为
$$
\begin{cases}
	x = (x_1 - x_0) \cos\beta - (y_1 - y_0) \sin\beta, \\
	y = (x_1 - x_0) \sin\beta + (y_1 - y_0) \cos\beta.
\end{cases}
$$

#### 1.1.2	线关于点的旋转

欲求直线 $ A_1 x + B_1 y + C_1 = 0 $ 关于原点顺时针旋转 $ \beta $ 后的坐标，我们单独研究直线上的每一点 $ (x_1, y_1) $，有
$$
\begin{cases}
	x = x_1 \cos\beta - y_1 \sin\beta, \\
	y = x_1 \sin\beta + y_1 \cos\beta.
\end{cases}
\QRA
\begin{cases}
	x_1 = x \cos\beta + y \sin\beta, \\
	y_1 = -x \sin\beta + y \cos\beta.
\end{cases}
$$
上式可联立方程解得，也可以直接根据 $ (x_1, y_1) $ 可看作由 $ (x, y) $ 绕原点顺时针旋转 $ -\beta $ 而得. 代入直线方程，消去 $ x_1, y_1 $，得旋转后的直线为
$$
(A_1 \cos\beta - B_1 \sin\beta) x +
(A_1 \sin\beta + B_1 \cos\beta) y + C = 0.
$$
关于任意点 $ (x_0, y_0) $ 的旋转公式是类似的，只需要将上式的 $ x $ 和 $ y $ 分别替换为 $ (x - x_0) $ 和 $ y - y_0 $ 即可.

记旋转后的直线为 $ Ax + By + C = 0 $，于是有系数变换
$$
\label{1.1.2 线的旋转}
\begin{cases}
	A = A_1 \cos\beta - B_1 \sin\beta, \\
	B = A_1 \sin\beta + B_1 \cos\beta.
\end{cases}
$$

注意到上式与（$ \ref{1.1.1 点的旋转} $）式形式相同，这是因为对直线的旋转，也是对直线的法向量 $ (A_1, B_1) $ 的旋转. 同时 $C$ 保持不变，这是因为旋转只改变法向量的方向，而不改变其长度.

### 1.2	旋转矩阵

#### 1.2.1	二阶矩阵

由矩阵及其乘法的定义，（$ \ref{1.1.1 点的旋转} $）（$ \ref{1.1.2 线的旋转} $）的变换方程可表示为
$$
\begin{align}
\begin{pmatrix}
	x \\ y
\end{pmatrix}
&= \begin{pmatrix}
	\cos\beta & -\sin\beta \\
	\sin\beta & \cos\beta
\end{pmatrix}
\begin{pmatrix}
	x_1 \\ y_1
\end{pmatrix},
\\
\begin{pmatrix}
	A \\ B
\end{pmatrix}
&= \begin{pmatrix}
	\cos\beta & -\sin\beta \\
	\sin\beta & \cos\beta
\end{pmatrix}
\begin{pmatrix}
	A_1 \\ B_1
\end{pmatrix}.
\end{align}
$$
其中左乘的矩阵称为旋转矩阵，简记为 $ [R_\beta] $. 这样的记号是有好处的，因为它将角度与坐标分开了，便于研究变换的复合；这里的中括号是沿用了复分析里的习惯，不加中括号则表示旋转变换，加了中括号则表示旋转矩阵.

尽管矩阵乘法具有结合律，若干个矩阵相乘，从左向右算或从右向左算都可以得到正确的答案，但作为变换看待的矩阵，应当理解为从右向左算，因为这对应了逐次的变换. 这并不奇怪，一般来说映射也是从右向左算的，而左乘矩阵实际上可以看作多元函数.

由上，可以验证旋转矩阵具有如下性质：

1. $ \det[R_\alpha] = 1 $.
2. $ [R_\alpha]\inv = [R_{-\alpha}] = [R_\alpha]\trans $.
3. $ [R_\beta] [R_\alpha] = [R_{\alpha + \beta}] = [R_\alpha] [R_\beta] $.

#### 1.2.2	三阶矩阵

对于任意点 $ (x_0, y_0) $ 的旋转，可以同样地表示为
$$
\begin{pmatrix}
	x \\ y
\end{pmatrix}
= \begin{pmatrix}
	\cos\beta & -\sin\beta \\
	\sin\beta & \cos\beta
\end{pmatrix}
\begin{pmatrix}
	x_1 - x_0 \\ y_1 - y_0
\end{pmatrix},
$$
不过平移不是线性变换，无法分离出矩阵，除非使用三阶矩阵：
$$
\begin{pmatrix}
	x_1 - x_0 \\ y_1 - y_0 \\ 0
\end{pmatrix}
= \begin{pmatrix}
	1 & 0 & -x_0 \\
	0 & 1 & -y_0 \\
	0 & 0 & 1
\end{pmatrix}
\begin{pmatrix}
	x_1 \\ y_1 \\ 1
\end{pmatrix},
$$
不过代价是存储空间与计算量的增大. 有兴趣的读者可以思考一下旋转变换 $ [R_\alpha] $ 与伸缩变换 $ (x, y) = (k x_1, k y_1) $ 对应的三阶矩阵是什么，不过这不是本文的重点.

### 1.3	复数旋转

#### 1.3.1	复数代数

对于复数及其运算，这里仅作回顾. 记 $ \i^2 = -1 $，则 $ z \in \C $ 可表示为

1. 直角坐标：$ z = a + b\i $，其中 $ a \in \R $ 称为实部，$ b \in \R $ 称为虚部.
2. 极坐标系：$ z = r \e^{\i\theta} $，其中 $ r \in \R $ 称为模长，$ \theta \in \R $ 称为幅角.

换算关系由欧拉公式给出：$ \e^{\i\theta} = \cos\theta + \i\sin\theta $，并且有如下计算法则

1. 加法：$ (a_1 + b_1\i) + (a_2 + b_2\i) = (a_1 + a_2) + (b_1 + b_2) \i $.
2. 乘法：$ r_1\e^{\i\theta_1} \cdot r_2 \e^{\i\theta_2} = r_1 r_2 \e^{\i(\theta_1 + \theta_2)} $.

将复数看作平面上的点，并称该平面为复平面：
$$
\begin{align*}
\C &\to \R^2 \\
a + b\i &\mapsto (a, b)
\end{align*}
$$
于是复数加法可以看作平移变换，复数乘法可以看作伸缩旋转，从而可以用于求解旋转变换，具体见下一节.

上面我们回忆了直角坐标下的复数加法与极坐标下的复数乘法，其它运算不是本文的重点. 不过其中极坐标下具有相同模长的复数相加减，比较有趣，但也常被教学所忽略，结论如下，有兴趣的读者可以尝试用代数与几何的方法分别证明.

1. $ \e^{\i \theta} + \e^{\i \phi} = 2 \cos \dfrac{\theta - \phi}{2} \cdot \e^{\tfrac{\i (\theta + \phi)}{2}} $.
2. $ \e^{\i \theta} - \e^{\i \phi} = 2\i \sin \dfrac{\theta - \phi}{2} \cdot \e^{\tfrac{\i (\theta + \phi)}{2}} $.

#### 1.3.2	复数变换

保向变换如下，直接抄了之前的笔记，以后可能会补充解释.

- **恒等变换**: $ \mathcal{E} (z) = z $.

- **平移变换**: $ \mathcal{T}_v (z) = z + v $.

  - 复合: $ \mathcal{T}_w \circ \mathcal{T}_v = \mathcal{T}_{w + v} $.
  - 逆元: $ \mathcal{T}_v\inv = \mathcal{T}_{-v} $.

- **旋转变换**: $ \mathcal{R}_a^\theta $.

  - 复合: $ \mathcal{R}_a^\phi \circ \mathcal{R}_a^\theta = \mathcal{R}_a^{\phi + \theta} $.

  - 逆元: $ (\mathcal{R}_a^\theta)\inv = \mathcal{R}_a^{-\theta} $.

  - 分解:

    - $ \mathcal{R}_a^\theta(z)
      = (\mathcal{T}_a \circ \mathcal{R}_0^\theta \circ \mathcal{T}_a\inv)(z)
      = \e^{\i \theta} (z - a) + a $.
    - $ \mathcal{R}_a^\theta
      = \cal T_k \circ \cal R_0^\theta $, 其中  $ k = a (1 -\e^{\i\theta}) $.

  - 复合:

    - $ \cal T_v \circ \cal R_a^\theta = \cal R_c^\theta $, 其中 $ c = a + \dfrac{v}{1 - \e^{\i\theta}} $.

    - $ \cal R_a^\theta \circ \cal T_v = \cal R_c^\theta $, 其中 $ c = a + \dfrac{v \e^{\i\theta}}{1 - \e^{\i\theta}} $.

    - $ (\cal R_b^\beta \circ \cal R_a^\alpha)(z) = \e^{\i (\alpha + \beta)} z + a (1 - \e^{\i\alpha}) \e^{\i \beta} + b(1 - \e^{\i\beta}) $.

      - 当 $ \alpha + \beta \ne 2k\pi $ 时, $ \cal R_b^\beta \circ \cal R_a^\alpha = \cal R_c^{\alpha + \beta} $, 其中 $ c = \dfrac{a (1 - \e^{\i\alpha}) \e^{\i \beta} + b(1 - \e^{\i\beta})}{1 - \e^{\i (\alpha + \beta)}} $.
      - 当 $ \alpha + \beta = 2k\pi $ 时, $ \cal R_b^\beta \circ \cal R_a^\alpha = \cal T_k $. 其中 $ k = (b - a) (1 - \e^{\i\beta}) $.

      <span style="border-left: 4px solid #dfe2e5; padding: 0 15px; color: #777777; padding-right: 0;">上式可推广至 n 次旋转的组合, 不再赘述.</span>

- **中心伸缩 (位似变换)**: $ \cal D_a^r %= \cal D_a^{r, 0} $.

- **伸缩旋转 (相似变换)**: $ \cal D_a^{r, \theta} \equiv \cal R_a^\theta \circ \cal D_a^r \equiv \cal D_a^r \circ \cal R_a^\theta $.

  - 复合: $ \cal D_o^{R, \phi} \circ \cal D_o^{r, \theta} = \cal D_o^{r, \theta} \circ \cal D_o^{R, \phi} = \cal D_o^{Rr, \theta + \phi} $.
  - 逆元: $ (\cal D_a^{r, \theta})\inv = \cal D_a^{1 / r, -\theta} $.

  - 分解
    - $ \cal D_a^{r, \theta}(z) = (\cal T_a \circ \cal D_o^{r, \theta} \circ \cal T_a\inv) (z) = r\e^{\i\theta} (z - a) + a $.
    - $ \cal D_a^{r, \theta} = \cal T_k \circ \cal D_o^{r, \theta} $, 其中 $ k = a (1 - r\e^{\i\theta}) $.

  - 复合
    - $ (\cal D_b^{R, \beta} \circ \cal D_a^{r, \alpha})(z) = Rr \e^{\i(\alpha + \beta)} + a(1 - r\e^{\i\alpha}) \e^{\i\beta} + b(1 - R\e^{\i\beta}) $.
      - 当 $ r\e^{\i(\alpha + \beta)} \ne 0 $ 时, $ \cal D_b^{R, \beta} \circ \cal D_a^{r, \alpha} = \cal D_c^{Rr, \alpha + \beta} $, 其中 $ c = \dfrac{a (1 - r\e^{\i\alpha}) R\e^{\i \beta} + b(1 - R\e^{\i\beta})}{1 - Rr\e^{\i (\alpha + \beta)}} $.
      - 当 $ r\e^{\i(\alpha + \beta)} = 0 $ 时, $ \cal D_b^{R, \beta} \circ \cal D_a^{r, \alpha} = \cal T_k $, 其中 $ k = a(\e^{\i\beta} - r) + b(1 - R\e^{\i\beta}) $.



## 2	空间旋转

### 2.1	空间旋转思路

#### 2.1.1	旋转思路概述

处理空间旋转，常见的思路有：

1. 利用欧拉角
   1. 经典欧拉角.
   2. 泰特布莱恩角.
2. 利用轴角
   1. 罗德里格斯旋转公式.
   2. 四元数旋转公式.
3. 利用莫比乌斯变换.
4. 利用矩阵.

其中利用欧拉角的方法，最直观，参数也最少 (3 个参数)，并且也有利于同时处理旋转与平移变换. 但是为了提高计算效率，往往会存储 6 个单位数据；而且三维空间中的任意一个方向，都可以通过至少两种不同的欧拉角表示，即存在着歧义性问题；此外，欧拉角还存在着万向节死锁的问题.

利用轴角可以避免歧义性问题与万向节锁死. 其中罗德里格斯旋转公式易于理解、容易运用，但是计算量大，计算精度较低. 更重要的是，该公式的应用是对应固定的旋转轴而言的，难以求解旋转的复合. 相比之下，四元数形式复杂，难以理解，但是计算量小，需要的存储空间也少，在求解旋转的复合上也有着优势. 但四元数也存在着算法上的缺点，即难以同时处理旋转与位移变换.

利用莫比乌斯线性变换与黎曼球面，虽然思路简明清晰，但是结果非常复杂，而且计算量很大. 不过这个方法的结果可以大大简化四元数旋转公式的推导. 但是由于需要复分析的前置知识，下文将列出结论后直接应用，而不再推导，具体步骤可以参考 Tristan Needham 的《复分析：可视化方法》.

最后的 "利用矩阵"，其实并不能称之为思路，因为旋转矩阵不是凭空出现的，而是由前面的各种方法推导而来. 实际上，以上每一种方法都有相应的矩阵公式，比如四元数既同构于二阶复矩阵的子环，也同构于四阶实矩阵的子环，因此就有了两种矩阵表示.

#### 2.1.2	罗德里格公式

网上有许多文章解释了欧拉角，故这里不再重述. 有兴趣的读者可以参考这篇文章：https://www.zhihu.com/question/47736315. 这里仅介绍罗德里格斯旋转公式，如图（图片来自网络）

<img src="https://img2018.cnblogs.com/blog/1903168/202002/1903168-20200217220414404-1389795950.png" alt="向量的分解图示" style="zoom:67%;" />

先说结论，设转轴的单位方向向量为 $ \bm k $，旋转前的向量为 $ \bm v $，旋转 $ \theta $ 后的向量为 $ \bm v' $（即图中的 $ \bm v_\text{rot} $），则
$$
\begin{align}
\label{2.1.2 罗德里格斯旋转公式-1}
\bm v' &= \cos\theta \bm v + (1 - \cos\theta) (\bm v \cdot \bm k) \bm k + \sin\theta \bm k \cp \bm v
\\
\label{2.1.2 罗德里格斯旋转公式-2}
&= \bm v + (1 - \cos\theta) \bm k \cp (\bm k \cp \bm v) + \sin\theta \bm k \cp \bm v.
\end{align}
$$
**证明**	

令 $ \bm v $ 平行于 $ \bm k $ 的分量为 $ \bm v_\parallel $，垂直于 $ \bm k $ 的分量为 $ \bm v_\perp $，则 $ \bm v = \bm v_\parallel + \bm v_\perp $.

$ \bm v' $ 记号同理，并令 $ \bm w = \bm k \cp \bm v_\perp $，则 $ \bm w = \bm k \cp \bm v $. 若消去 $ \bm v_\perp $，则有
$$
\begin{align*}
% \bm v_\parallel &= (\bm v \cdot \bm k) \bm k, \\
% \bm v_\perp &= \bm v - \bm v_\parallel, \\
% \bm w &= \bm k \cp \bm v, \\
\bm v' &= \bm v_\parallel + \bm v'_\perp \\
&= \bm v_\parallel + (\cos\theta \bm v_\perp + \sin\theta \bm w)
\\
&= \bm v_\parallel + \cos\theta (\bm v - \bm v_\parallel) + \sin\theta \bm w
\\
&= \cos\theta \bm v + (1 - \cos\theta) \bm v_\parallel + \sin\theta \bm w
\\
&= \cos\theta \bm v + (1 - \cos\theta) (\bm v \cdot \bm k) \bm k + \sin\theta \bm k \cp \bm v.
\end{align*}
$$
若消去 $ \bm v_\parallel $，则有
$$
\begin{align*}
\bm v' &= \bm v_\parallel + \bm v'_\perp
\\
&= (\bm v - \bm v_\perp) +
(\cos\theta \bm v_\perp + \sin\theta \bm w)
\\
&= \bm v + (\cos\theta - 1) \cp \bm v_\perp + \sin\theta \bm k \cp \bm v
\\
&= \bm v + (1 - \cos\theta) \bm k \cp (\bm k \cp \bm v) + \sin\theta \bm k \cp \bm v.
\end{align*}
$$
实际上，上式还可以直接由 $ \bm A \cp (\bm B \cp \bm C) = \bm B(\bm A \cdot \bm C) - \bm C(\bm A \cdot \bm B) $ 得到.

#### 2.1.3	空间旋转矩阵

欲从罗德里格斯旋转公式推导矩阵形式，最大的阻力是叉乘. 故这里引入反对称矩阵，即对于
$$
\bm a \cp \bm b = \begin{vmatrix}
	\bm i & \bm j & \bm k \\
	a_1 & a_2 & a_3 \\
	b_1 & b_2 & b_3
\end{vmatrix} = \begin{bmatrix}
	a_2 b_3 - a_3 b_2 \\
	a_3 b_1 - a_1 b_3 \\
	a_1 b_2 - a_2 b_1
\end{bmatrix},
$$
我们定义 $ \bm a = (a_1, a_2, a_3)\trans $ 的反对称矩阵为
$$
\bm a\hat{\;} =  \begin{bmatrix}
	0 & -a_3 & a_2 \\
	a_3 & 0 & -a_1 \\
	-a_2 & a_1 & 0
\end{bmatrix}.
$$
于是有 $ \bm a \cp \bm b = \bm a \hat{\;}\, \bm b $，将向量叉乘转换为了矩阵乘法.

记 $ \bm I $ 为单位矩阵，则式（$ \ref{2.1.2 罗德里格斯旋转公式-1} $）与（$ \ref{2.1.2 罗德里格斯旋转公式-2} $）可表示为 $ \bm v' = \bm R \bm v $，其中
$$
\begin{align}
\bm R &= \cos\theta \bm I + (1 - \cos\theta) \bm k \bm k\trans + \sin\theta \bm k \hat{\;}
\\
&= \bm I + (1 - \cos\theta) (\bm k \hat{\;}\,)^2 + \sin\theta \bm k \hat{\;}.
\end{align}
$$
记 $ \bm k = (k_1, k_2, k_3)\trans $，则展开为矩阵形式后即为
$$
\bm R = \left(
\begin{array}{ccc}
 \cos\theta+{k_1}^2 (1-\cos\theta) & {k_1}^2 (1-\cos\theta)-{k_3} \sin\theta & {k_1}^2 (1-\cos\theta)+{k_2} \sin\theta \\
 {k_2}^2 (1-\cos\theta)+{k_3} \sin\theta & \cos\theta+{k_2}^2 (1-\cos\theta) & {k_2}^2 (1-\cos\theta)-{k_1} \sin\theta \\
 {k_3}^2 (1-\cos\theta)-{k_2} \sin\theta & {k_1} \sin\theta+{k_3}^2 (1-\cos\theta) & \cos\theta+{k_3}^2 (1-\cos\theta) \\
\end{array}
\right).
$$
注意这里的旋转矩阵是三阶矩阵，之后在四元数中我们会发现还可以表示为二阶复矩阵或三阶实矩阵，只不过其它运算也会发生相应的改变.

### 2.2	四元数的起源

#### 2.2.1	动机与三元数

由上，利用欧拉角求解空间旋转存在着万向节死锁的问题，罗德里格斯公式计算复杂、难以求解旋转复合，实际上，利用莫比乌斯变换得到的旋转矩阵在应用时也较为繁琐. 因此，我们需要寻找一种便捷且适用性广的求解空间旋转的方法.

我们知道，复数是实数的推广，而复数的乘法恰好对应了复平面上的旋转. 那么可不可以推广复数，使得某种 "超复数" 存在某种运算可以对应空间旋转呢？

在 $ \i^2 = -1 $ 的基础上, 补充定义 $ \j^2 = -1, \i \ne \j $ 是很自然的想法, 于是三元数是 $ \R $ 上的线性空间. 但是 $ \i\j $ 应该等于多少呢? 由乘法的封闭性, 不妨令
$$
\i\j = x + y \i + z \j, x, y, z \in \R.
$$
首先我们看到, $ z \ne 0 $, 否则两端左乘 $ \i $ 得 $ \j = -y + x \i \in \C $, 本质上还是复数.

于是由上式可得
$$
\begin{align}
\j &= \dfrac{1}{z} (\i \j - x - y \i),
\\
\i\j &= \dfrac{1}{z} (-\j - x\i + y),
\end{align}
$$
比较系数可得 $ z^2 = -1, z \not\in \R $, 矛盾, 从而 $ \i \j $ 不能由上述三元数表示.

这个反证法的思路与 $ \sqrt 2 $ 不是有理数的证明类似. 不过 $ \sqrt2 $ 虽然不属于有理数, 但属于实数, 有没有可能寻找到更大的代数系统, 使得乘法的封闭性得以满足呢?

#### 2.2.2	四元数的起源

自然的想法是令 $ \k = \i\j \not\in \C $, 同样自然的, 我们令 $ \i\j = \j\i $, 即满足交换律, 于是 $ \k^2 = 1 $. 现在我们知道, 这样的代数系统称为双复数, 不过更常见的定义是令 $ \i^2 = -1, \j^2 = 1, \i\j = \j\i = \k $, 其子环 $ \R[\i] $ 称为圆复数 (即复数 $\C$), 而 $ \R[\j] $ 称为双曲复数. 顾名思义, 双曲复数与双曲线有着密不可分的联系, 不过不是这里讨论的重点.

旋转运动是可逆的, 因此我们希望四元数除零元外都可逆. 双复数不能作为我们理想的 "四元数", 因为双复数有零因子, 从而双复数的乘法未必可逆. 例如 $ (1 + \k)(1 - \k) = 0 $, 假设零因子 $ 1 + k $ 有逆元且为 $ a\inv $, 等式两端左乘 $ a\inv $, 得 $ \k = 1 $, 从而矛盾.

似乎又陷入了窘境, 而且这样构造出来的双复数在运算上不具有轮换对称性, 并不美观. 不过回过头来, 我们希望的是通过三元或四元的 "超复数" 来研究三维的空间旋转, 空间旋转又具有怎样的性质呢? 我们惊讶地发现, 空间旋转并不满足交换律! 随便拿起一支笔或一颗魔方, 便可以验证这一点.

如果让四元数也不满足交换律呢? 实数是满足交换律的, 因此我们令 $ \i\j \ne \j\i $, 但具体是怎样的关系呢? 互为相反数是最简单的, 即 $ \i\j = -\j\i $, 于是我们可以推得 $ \k^2 = -1, \j\k = -\k\j, \k\i = -\i\k $, 这些运算恰好也是轮换对称的.

进一步我们还可以得到这种定义的四元数的诸多良好性质, 其中就包括非零元必有逆, 并且可以利用四元数方便地求解空间旋转的复合和效果. 这些就是接下来要推导的了. 即使抛开实际应用, 四元数作为纯数学, 内容也是丰富而有趣的.

最后, 数学之外的有关哈密顿发现四元数的故事, 有兴趣可以看看这篇文章：https://zhuanlan.zhihu.com/p/150699389

#### 2.2.3	超复数的分类

以上我们探索了三种形式的超复数, 作为复数的 "扩展", 它们的定义分别是:

1. $ \i^2 = -1, \j^2 = -1, \i\j = \j\i = \k $. (双复数的等价超复数)
2. $ \i^2 = -1, \j^2 = 1, \i\j = \j\i = \k $. (双复数)
3. $ \i^2 = -1, \j^2 = -1, \i\j = -\j\i = \k $. (四元数)

从形式上看, 只剩下一个有待研究:

4. $ \i^2 = -1, \j^2 = 1, \i\j = -\j\i = \k $. (反四元数)

这种超复数称为分裂四元数或反四元数, 与双复数一样, 它也有非零元无逆, 如 $ \dfrac{1 + \j}{2} $ 即为幂等的零因子, 因此反四元数的性质也没有四元数好.

最后, 我们之后使用的四元数单位的字体与前文不同, 不再是正体. 四元数单位之所以要使用大写的粗斜体, 是为了与复数单位区分. 由复数推广至四元数是自然的, 但是之后在研究四元数时, 常将其同构映射为复矩阵, 此时若不用粗斜体, 则容易混淆; 而小写的粗斜体常用于表示空间向量, 因此表示为 $ \bm I, \bm J, \bm K $ 是最为清晰的.

### 2.3	四元数的代数

#### 2.3.1	基本性质

##### 1	四元数的概念

- 定义 $ \mathbb V $ 
  - $ \bm I^2 = \bm J^2 = \bm K^2 = \bm I\bm J\bm K = -1 $.
  - $ \mathbb{V} = v \bm 1 + v_1 \bm I + v_2 \bm J + v_3 \bm K $.
  - 读者可验证上述定义与上一节中的定义等价.
- 备注
  - 这里使用空心字母表示四元数元素, 而非集合, 以区分于标量和向量.
  - 这里四元数单位使用粗斜体, 表明它是 (四维实) 向量或 (二阶复) 矩阵.
  - 有的资料上使用正体表示四元数单位, 表明它是标量常数; 这里不建议如此表示.
- 概念
  - 数量部分: $ v = v \bm 1 $.
  - 向量部分: $ \bm V = v_1 \bm I + v_2 \bm J + v_3 \bm K $.
  - 纯四元数: $ \mathbb V = \bm V $.

##### 2	基本代数性质

- 性质
  - $ \bm I \bm J = \bm K,\, \bm J \bm K = \bm I,\, \bm K \bm I = \bm J $.
  - $ \bm I \bm J = -\bm J \bm I,\, \bm J \bm K = -\bm K \bm J,\, \bm K \bm I = -\bm I \bm K $.
  - $ \bm I \bm J \bm K = \bm J \bm K \bm I = \bm K \bm I \bm J = -1 $.
- 乘法
  - $ \bm V \bm W = -\bm V \cdot \bm W + \bm V \cp \bm W $.
  - $ \bb V \bb W = (vw - \bm V \cdot \bm W) + (v\bm W + w \bm V + \bm V \cp \bm W) $.
- 备注
  - 将四元数集合视为 $ \R $ 上的线性空间, 加法与乘法都是通常意义下的.
  - 将纯四元数视为三维空间向量, 点积与叉积都是通常意义下的.
  - 四元数无乘法交换律, 不能成域, 而只能构成环, 称为哈密顿四元数除环 $ \bb H $.

##### 3	两种矩阵同构

注: $ \GL_n(\F) $ 表示域 $ \F $ 上由 $n$ 阶矩阵构成的一般线性群.

- 二阶复矩阵
  $$
  \begin{array}{crl}
  \phi_1: &
  Q_4 \hspace{-0.75em} &\to \GL_2(\C)
  \\
  & \bb V \hspace{-0.75em} &= a \bm 1 + b \bm I + c \bm J + d \bm K
  \\
  && \mapsto \begin{pmatrix}
  	a - d \i & -b + c \i \\
  	b + c \i & a + d \i
  \end{pmatrix}
  % \bb V &= v \bm 1 + v_1 \bm I + v_2 \bm J + v_3 \bm K
  % \\
  % & \mapsto \begin{pmatrix}
  % 	v - v_3 \i & -v_1 + v_2 \i \\
  % 	v_1 + v_2 \i & v + v_3 \i
  % \end{pmatrix}
  \end{array}
  $$

  - $ \bm 1 = \begin{bmatrix}
    	1 & 0 \\
    	0 & 1
    \end{bmatrix} $, 对应于 $ {\it 1}(z) = z $, 即恒等变换.
  - $ \bm I = \begin{bmatrix}
    	0 & \i \\
    	\i & 0
    \end{bmatrix} $, 对应于 $ I(z) = \dfrac{1}{z} $, 即黎曼球面绕 $ x_1 $ 轴旋转 $ 180^\circ $.
  - $ \bm J = \begin{bmatrix}
    	0 & -1 \\
    	1 & 0
    \end{bmatrix} $, 对应于 $ J(z) = - \dfrac{1}{z} $, 即黎曼球面绕 $ x_2 $ 轴旋转 $ 180^\circ $.
  - $ \bm K = \begin{bmatrix}
    	\i & 0 \\
    	0 & -\i
    \end{bmatrix} $, 对应于 $ K(z) = -z $, 即黎曼球面绕 $ x_3 $ 轴旋转 $ 180^\circ $.

- 四阶实矩阵
  $$
  \begin{array}{crl}
  \phi: & Q_4 \hspace{-0.75em} & \to \GL_4(\R)
  \\
  & \bb V \hspace{-0.75em} &= a \bm 1 + b \bm I + c \bm J + d \bm K
  \\
  && \mapsto \begin{pmatrix}
  	a & -b & d & -c \\
  	b & a & -c & -d \\
  	-d & c & a & -b \\
  	c & d & b & a
  \end{pmatrix}
  \end{array}
  $$
   其中四元数单位被映射为
  $$
  \begin{array}{c}
  \bm 1 \mapsto \begin{pmatrix}
  	1 \\
  	& 1 \\
  	&& 1 \\
  	&&& 1 \\
  \end{pmatrix},
  &
  \bm I \mapsto \begin{pmatrix}
  	& -1 \\
  	1 \\
  	&&& -1 \\
  	&& 1
  \end{pmatrix},
  \\
  \bm J \mapsto \begin{pmatrix}
  	&&& -1 \\
  	&& -1 \\
  	& 1 \\
  	1
  \end{pmatrix},
  &
  \bm K \mapsto \begin{pmatrix}
  	&& 1 \\
  	&&& -1 \\
  	-1 \\
  	& 1
  \end{pmatrix}.
  \end{array}
  $$

- 备注

  - 以下将 $ Q_4 $ 与 $ \GL_2(\C) $ 中的元素看成是相等的, 而不采用 $ \GL_4(\R) $ 的同构.

  - 想要通过计算机求解四元数运算, 可以利用矩阵形式.


#### 2.3.2	常用算符

##### 1	共轭性质

共轭 $ \overline{\bb V} $ 是对于四元数而言的, 而非矩阵共轭.

- $ \overline{\bb V} := \bb V^* $ (相应矩阵的共轭转置).
- $ \overline{\bb V} = v - \bm V $.
- $ \overline{\bm V \bm W} = \bm W \bm V % \overline{\bm W}\ \overline{\bm V} $. (注意顺序)
- $ \overline{\bb V \bb W} = \overline{\bb W}\ \overline{\bb V} $. (注意顺序)

**证明**

(1) 式为矩阵共轭定义, (2) 式为向量共轭定义, 由矩阵表示可知二者等价.
$$
\begin{align*}
\overline{\bm V \bm W} &= \overline{
	\dsum v_i w_i \bm I^2 + \dsum v_i w_j \bm I \bm J
} \\
&= - \dsum v_i w_i - \dsum v_i w_j \bm K
\\
&= - \dsum v_i w_i + \dsum v_i w_j \bm J \bm I
\\
&= \bm W \bm V = \overline{\bm W}\ \overline{\bm V}.
\end{align*}
$$

$$
\begin{align*}
\overline{\bb V \bb W} &= \overline{(v + \bm V)(w + \bm W)}
\\
&= \overline{vw + v \bm V + w \bm W + \bm V \bm W}
\\
&= vw - v \bm V - w \bm W + \bm W \bm V
\\
&= (w - \bm W)(v - \bm V) = \overline{\bb W}\ \overline{\bb V}.
\end{align*}
$$

##### 2	长度性质

长度 $ \vqty{\bb V} $ 又称为二范数.

- $ \vqty{\bb V}^2 := {\bb V \overline{\bb V}} = \overline{\bb V} \bb V = \vqty{\overline{\bb V}}^2 $.
- $ \vqty{\bm V}^2 = - \bm V^2 = - \bm V \bm V = \bm V \cdot \bm V $.
- $ \vqty{\bb V}^2 = v^2 + \vqty{\bm V}^2 = v^2 + v_1^2 + v_2^2 + v_3^3 $.
- $ \vqty{\bb V \bb W} = \vqty{\bb V} \vqty{\bb W} $.
- $ \vqty{\bb V}^2 = \det(\bb V) $.

**证明**
$$
\begin{align*}
\vqty{\bm V}^2 &= -\bm V\bm V
= \sum v_i^2 + \sum v_i v_j (\bm I \bm J + \bm J \bm I)
= \sum v_i^2 = \bm V \cdot \bm V.
\\
\vqty{\bb V}^2 &= v^2 - \bm V^2 = v^2 + \vqty{\bm V}^2 = v^2 + v_1^2 + v_2^2 + v_3^2.
\\
\vqty{\overline{\bb V}}^2 &= v^2 + \vqty{-\bm V}^2 = \vqty{\bb V}^2.
\\
\vqty{\bb V \bb W}^2 &= \bb V \bb W \overline{\bb V \bb W}
= \bb V\ \bb W \overline{\bb W}\ \overline{\bb V}
= \bb V \overline{\bb V} \vqty{\bb W}^2 = \vqty{\bb V}^2 \vqty{\bb W}^2.
\\
\det(\bb V) &= (v - v_3\i)(v + v_3\i) - (-v_1 + v_2\i)(v_1 + v_2\i) = v^2 + \dsum v_i^2 .
\end{align*}
$$

##### 3	逆与伴随

- 定义: $ \bb V \bb V \inv = \bb V\inv \bb V = 1 $.
- 计算: $ \bb V\inv = \dfrac{\overline{\bb V}}{\vqty{\bb V}^2} = \dfrac{\bb V\adj}{\vqty{\bb V}^2} $. (向量形式和矩阵形式)
- 旋转: $ (\bb R_\bm v^\psi)\inv = (\bb R_\bm v^\psi)\adj = \overline{\bb R_\bm v^\psi} = \bb R_\bm v^{-\psi} = \bb R_{-\bm v}^\psi $.
- 共轭转置: $ \overline{\bb V} = \bb V^* = \mathrm{adj}(\bb V) $. (伴随矩阵)
- 模长: $ \vqty{\bb V\inv} = \vqty{\bb V}\inv $.
- 交换: $ \overline{\bb V\inv} = \overline{\bb V}\inv $.

**证明**	
$$
\begin{align*}
\bb V\inv &= \dfrac{\vqty{\bb V}^2 \bb V\inv}{\vqty{\bb V}^2}
= \dfrac{\bb V\adj \bb V\, \bb V\inv}{\vqty{\bb V}^2}
= \dfrac{\bb V\adj}{\vqty{\bb V}^2}.
\\
\mathrm{adj}(\bb V) &= \det(\bb V) \bb V\inv
= \vqty{\bb V}^2 \bb V\inv = \bb V\adj.
\\
\overline{\bb V\inv} &= \dfrac{\bb V}{\vqty{\bb V}^2}
= \dfrac{\bb V}{\vqty{\overline{\bb V}}^2}
= \overline{\bb V}\inv.
\end{align*}
$$

#### 2.3.3	其它性质

##### 1	单位四元数

单位四元数 ($ \vqty{\bb V} = 1 $) 不一定是四元数单位.

- $ \vqty{\bb R_\bm v^\psi} = 1 $.
- $ \overline{\bb R_\bm v^\psi} = \bb R_\bm v^{-\psi} $.
- 当且仅当 $ \bb A^2 = -1 $ 时, $ \bb A $ 是纯的单位四元数.
- $ \forall \bb Q, \exist  \bm v, \psi: \bb Q = \vqty{\bb Q} \bb R_\bm v^\psi $.

**证明**
$$
\begin{align*}
\vqty{\R_\bm v^\psi} &= \vqty{
	\cos \dfrac{\psi}{2} + \bm V \sin \dfrac{\psi}{2}
} = \cos^2 \dfrac{\psi}{2} +
\vqty{\bm V}^2 \sin^2 \dfrac{\psi}{2} = 1.
\\
\overline{\R_\bm v^\psi}
&= \cos \dfrac{\psi}{2} + (- \bm V) \sin \dfrac{\psi}{2}
= \cos \dfrac{-\psi}{2} + \bm V \sin \dfrac{-\psi}{2}
= \R_\bm v^{-\psi}.
\\
\bb A^2 &= (a + \bm A)^2 = a^2 + 2a \bm A + \bm A^2 = -1
\RA a = 0.
\\
\bm A^2 &= -\vqty{\bm A}^2 = -1 \RLA \bm A\ 是纯的单位四元数.
\end{align*}
$$
第四点解方程即得 (有两解).

##### 2	二元的运算

- 点积 (内积)
  - $ \bb P \cdot \bb Q := pq + \bm P \cdot \bm Q $.
  - $ \bm P \cdot \bm Q = -\dfrac{\bm P \bm Q + \bm Q \bm P}{2} $.
  - $ \bb P \cdot \bb Q = \dfrac{\bb P\adj \bb Q + \bb Q\adj \bb P}{2} $.
- 叉积 (矢积, 向量积)
  - $ \bb P \cp \bb Q := \bm P \cp \bm Q $.
  - $ \bb P \cp \bb Q = \dfrac{\bb P \bb Q - \bb Q \bb P}{2} $.
- 外积
  - $ \Outer(\bb P, \bb Q) := \dfrac{\bb P\adj \bb Q - \bb Q\adj \bb P}{2} $.
  - $ \Outer(\bb P, \bb Q) = p \bm Q - q \bm P - \bm P \cp \bm Q $.
- 偶积
  - $ \Even(\bb P, \bb Q) := \dfrac{\bb P \bb Q + \bb Q \bb P}{2} $.
  - $ \Even(\bb P, \bb Q) = (pq - \bm P \cdot \bm Q) + (p \bm Q + q \bm P) $.

**证明**

- 点积

$$
\begin{align}
\bm P \bm Q + \bm Q \bm P &= \dsum p_i q_i (\bm I^2 + \bm I^2) + \dsum p_i q_j (\bm I \bm J + \bm J \bm I)
\\
&= -2\dsum p_i q_i = -2 \bm P \cdot \bm Q.
\end{align}
$$

$$
\begin{align}
\overline{\bb P} \bb Q &= (p - \bm P) (q + \bm Q)
= pq + p \bm Q - q \bm P - \bm P \bm Q,
\\
\overline{\bb Q} \bb P &= (p + \bm P) (q - \bm Q)
= pq - p \bm Q + q \bm P - \bm Q \bm P,
\\
\overline{\bb P} \bb Q + \overline{\bb Q} \bb P
&= 2pq - \bm P \bm Q - \bm Q \bm P
= 2pq + 2\bm P \cdot \bm Q
= 2 \bb P \cdot \bb Q.
\end{align}
$$

- 叉积

$$
\begin{align}
\bb P \bb Q &= (pq - \bm P \cdot \bm Q) + (p \bm Q + q \bm P + \bm P \cp \bm Q),
\\
\bb Q \bb P &= (pq - \bm P \cdot \bm Q) + (p \bm Q + q \bm P - \bm P \cp \bm Q),
\\
\bb P \bb Q - \bb Q \bb P &= 2 \bm P \cp \bm Q
= 2 \bb P \cp \bb Q.
\end{align}
$$

- 外积

$$
\begin{align}
\bm P \bm Q &= - \bm P \cdot \bm Q + \bm P \cp \bm Q,
\\
\bm Q \bm P &= - \bm P \cdot \bm Q - \bm P \cp \bm Q,
\\
\Outer(\bb P, \bb Q) &= p \bm Q - q \bm P - \bm P \bm Q + \bm Q \bm P
\\
&= p \bm Q - q \bm P - \bm P \cp \bm Q.
\end{align}
$$

- 偶积: 由叉积证明过程即得.

##### 3	一元的运算

- 纯量部 (标量部)
  - $ \Scalar(\bb P) = p $.
  - $ \Scalar(\bb P) = 1 \cdot \bb P $.
  - $ \Scalar(\bb P) = \dfrac{\bb P + \bb P\adj}{2} $.
- 向量部
  - $ \Vector({\bb P}) = \bm P $.
  - $ \Vector(\bb P) = \Outer(1, \bb P) $.
  - $ \Vector(\bb P) = \dfrac{\bb P - \bb P\adj}{2} $.
- 模
  - $ \vqty{\bb P} := \sqrt{\bb P\adj \bb P} = \sqrt{\overline{\bb P} \bb P} $.
  - $ \vqty{\bb P} = \sqrt{\bb P \cdot \bb P} = \sqrt{p^2 - \bm P^2} $.
  - $ \vqty{\bb P} = \sqrt{p^2 + p_1^2 + p_2^2 + p_3^2} $.
- 角度的度量
  - 符号数: $ \sgn(\bb P) := \dfrac{\bb P}{\vqty{\bb P}} $.
  - 另一表示: $ \sgn(\bb P) = \dfrac{\overline{\bb P\inv}}{\vqty{\bb P\inv}} $.
  - 幅角: $ \arg(\bb P) := \arccos\dfrac{p}{\vqty{\bb P}} $.

**证明**

- 纯量部与向量部: 由定义代入即得.
- 模: 即[长度](# 2	长度性质), 这里仅作总结, 结论均已证过.
- 符号数: $ \sgn(\bb P) = \dfrac{\bb P}{\vqty{\bb P}} = \overline{\bb P}\inv \vqty{\bb P} = \dfrac{\overline{\bb P\inv}}{\vqty{\bb P\inv}} $.

### 2.4	空间旋转公式

注：空间旋转公式即下文中的（$ \ref{2.4.1 旋转的矩阵} $）（$ \ref{2.4.1 旋转的效果} $）两式.

#### 2.4.1	矩阵证法

前置知识：黎曼球面上关于单位向量 $ \bm v = l \bm i + m \bm j + n \bm k $ 顺时针旋转 $ \psi $ 的变换，对应于复平面上莫比乌斯线性变换的矩阵形式为
$$
\bqty{R_\bm v^\psi} = \begin{bmatrix}
	\cos\dfrac{\psi}{2} + \i n\sin\dfrac{\psi}{2} &
	(-m + \i l) \sin \dfrac{\psi}{2} \\
	(m + \i l) \sin\dfrac{\psi}{2} &
	\cos\dfrac{\psi}{2} - \i n\sin\dfrac{\psi}{2}
\end{bmatrix}.
$$
如 [2.1.1](# 2.1.1	旋转思路概述) 中所说，这个式子我们不做证明，也不做解释，在本小节的推导里，只会以之作为推导的中间步骤.

- 旋转的矩阵 (可求复合)

  绕 $ \bm v = l \bm i + m \bm j + n \bm k $ 旋转 $ \psi $ 的矩阵 $ [R_\bm v^\psi] $.

  记 $ \bm V = l \bm I + m \bm J + n \bm K $, 代入四元数的二阶矩阵形式, 可得
  $$
  \label{2.4.1 旋转的矩阵}
  \R_\bm v^\psi = \cos \dfrac{\psi}{2} + \bm V \sin \dfrac{\psi}{2} =: \e^{\bm V \tfrac{\psi}{2}}.
  $$

- 旋转的效果 (可求象)

  一般的, $ \cal R_{\hat{\wt{p}}}^\theta = \cal R_\hat a^\psi \circ \cal R_\hat p^\theta \circ \cal R_\hat a^{-\psi} $, 即 $ \bb R_\wt{\bm P}^\theta = \bb R_\bm v^\psi \circ \bb R_\bm P^\theta \circ \bb R_\bm v^{-\psi} $.

  设 $ \cal R_\bm v^\psi $ 将 $ \bm P = x \bm i + y \bm j + z \bm k $ 旋转到 $ \wt{\bm P} $:

  在上式中令 $ \theta = \pi $, 则二元旋转 $ \R_\bm P^\theta $ 和 $ \R_{\wt{\bm P}}^\pi $ 正是纯四元数 $ \bb P $ 和 $ \wt{\bb{P}} $, 故有
  $$
  \label{2.4.1 旋转的效果}
  \wt{\bb{P}} = \bb{R}_\bm v^\psi \bb P \bb R_\bm v^{-\psi}.
  $$

- 伸缩旋转

  - $ \forall \bb Q, \exist  \bm v, \psi: \bb Q = \vqty{\bb Q} \bb R_\bm v^\psi $, 即伸缩旋转.

  - 由旋转的象的公式得, 伸缩旋转的效果为:
    $$
    \bb P \mapsto \wt{\bb P} = \bb Q \bb P \overline{\bb Q}.
    $$

#### 2.4.2	反射证法

**思路**	

若 $ \bb P $ 与 $ \bb A $ 为<u>纯四元数</u>, 则

- 正交的充要条件: $ \bb P \bb A + \bb A \bb P = 0 $.

- 若 $\bb A$ 为单位纯四元数, 即 $ \bb A^2 = -1 $,

  - 则上述方程化为 $ \bb P = \bb A \bb P \bb A $.

  - 令 $ \Pi_\bm A $ 表示以 $ \bm A $ 为法向量的过原点的平面, 其方程为 $ \bm P \cdot \bm A = 0 $.

    考虑变换 $ \bb P \mapsto \bb P' = \bb A \bb P \bb A $,

    - $ \bb P' $ 为纯四元数, 并且 $ \vqty{\bb P'} = \vqty{\bb P} $, 于是该变换表示空间中的运动.
    - $ \Pi_\bm A $ 上的每点均不动, 且正交于 $ \Pi_\bm A $ 的向量均被反向, 于是该映射为**反射** $ \frak R_{\Pi_\bm A} $.

  - 若由 $ \Pi_\bm A $ 到 $ \Pi_\bm B $ 的角为 $ \psi / 2 $, 两平面交线的单位向量为 $ \bm V $, 则旋转 $ \cal R_\bm v^\psi = \frak R_{\Pi_\bm A} \circ \frak R_{\Pi_\bm B} $ 可表示为
    $$
    \bb P \mapsto \wt{\bb P} = (-\bb B \bb A) \bb P (-\overline{\bb B \bb A}).
    $$

  - 其中 $ \bb R_\bm v^\psi = -\bb B \bb A = \cos\dfrac{\psi}{2} + \bm V \sin\dfrac{\psi}{2} $. ($ \bb P $ 和 $ -\bb P $ 的效果是一样的)

**证明**

由于是纯四元数, $ \bb P \bb A + \bb A \bb P = -2 \bm P \cdot \bm A $, 因此得到第一点.

当 $ \bb A^2 = -1 $, 第一点的两端同乘 $ \bb A $ 即得 $ \bb P = \bb A \bb P \bb A $.

$ \bb P' $ 为纯四元数的结论, 可以代入值后展开, 这里采用向量法另证:
$$
\begin{align}
\bb P' &= \bm A(-\bm P \cdot \bm A + \bm P \cp \bm A)
\\
&= -(\bm P \cdot \bm A) \bm A - \bm A \cdot (\bm P \cp \bm A) + \bm A \cp (\bm P \cp \bm A)
\\
&= -(\bm P \cdot \bm A) \bm A - \bm A \cdot (\bm P \cp \bm A) + (\bm A \cdot \bm A) \bm P - (\bm A \cdot \bm P) \bm A
\\
&= \bm P -2(\bm P \cdot \bm A) \bm A.
\\
\vqty{\bb P'} &= \vqty{\bb A \bb P \bb A}
= \vqty{\bb A} \vqty{\bb P} \vqty{\bb A} = \vqty{\bb P}.
\end{align}
$$
不动点可用正交的等价条件证明, 这里继续使用向量法:

当 $ \bm P \in \Pi_\bm A $ 时, $ \bm P \cdot \bm A = 0 $, 于是 $ \bb P' = \bm P $.

若 $ \bm P \perp \Pi_\bm A $, 则 $ \bb P' = \bm P - 2 \vqty{\bm P} \bm A = \bm P - 2\bm P = -\bm P $.
$$
\bb P \mapsto \wt{\bb P} = \bb B (\bb A \bb P \bb A) \bb B
= (-\bb B \bb A) \bb P (-\overline{\bb B \bb A}).
$$

$$
\begin{align}
-\bb B \bb A &= \bm B \cdot \bm A - \bm B \cp \bm A
= \cos\dfrac{\psi}{2} + \bm V \sin\dfrac{\psi}{2}.
\end{align}
$$

#### 2.4.3	向量证法

将 $ \Sigma $ 和 $ \C $ 中的点用 $ \C^2 $ 中的齐次坐标向量表示, 如 $ \bm{\frak p} = [\frak p_1, \frak p_2]\trans, z = p = \dfrac{\frak p_1}{\frak p_2} $, 则
$$
\bm{\frak p} \mapsto \wt{\bm{\frak p}} = \bb R_\bm v^\psi \bm{\frak p}.
$$
取 $ \aqty{\bm{\frak p}, \bm{\frak p}} \equiv \vqty{\frak p_1}^2 + \vqty{\frak p_2}^2 = 2 $, 则 $ \Sigma $ 与 $ \C $ 中点的换算公式为
$$
\begin{cases}
    X + \i Y = \dfrac{2z}{1 + \vqty{z}^2} = \dfrac{
        2 \frak p_1 \overline{\frak p}_2
    }{
    	\vqty{\frak p_1}^2 + \vqty{\frak p_2}^2
    } = \frak p_1 \overline{\frak p}_2, \\
    Z = \dfrac{\vqty{z}^2 - 1}{\vqty{z}^2 + 1} = \dfrac{
        \vqty{\frak p_1}^2 - \vqty{\frak p_2}^2
    }{
        \vqty{\frak p_1}^2 + \vqty{\frak p_2}^2
    } = \vqty{\frak p_1}^2 - 1.
\end{cases}
$$
记 $p$ 的球极射影象 $ \hat p $ 对应的单位向量为 $ \bm P = (X, Y, Z) $, 则
$$
\begin{align}
\bb P &= X \bm I + Y \bm J + Z \bm K
= \begin{bmatrix}
	\i Z & -Y + \i X \\
	Y + \i X & -\i Z
\end{bmatrix}
\end{align}
$$
注意到
$$
1 - \i \bb P = \begin{bmatrix}
	1 + Z & X + \i Y \\
	X - \i Y & 1 - Z
\end{bmatrix} = \begin{bmatrix}
	\frak p_1 \overline{\frak p}_1 &
	\frak p_1 \overline{\frak p}_2 \\
	\frak p_2 \overline{\frak p}_1 &
	\frak p_2 \overline{\frak p}_2
\end{bmatrix} = \begin{bmatrix}
	\frak p_1 \\ \frak p_2
\end{bmatrix} \begin{bmatrix}
	\,\overline{\frak p}_1 & \overline{\frak p}_2 
\end{bmatrix} = \bm{\frak p} \bm{\frak p}\adj.
$$
于是有
$$
\begin{align}
1 - \i \wt{\bb P} &= \wt{\bm{\frak p}} \wt{\bm{\frak p}}\adj
= \pqty{
	\bb R_\bm v^\psi \bm{\frak p}
} \pqty{
	\bb R_\bm v^\psi \bm{\frak p}
}\adj = \bb R_\bm v^\psi
\bm{\frak p} \bm{\frak p}\adj
\pqty{\R_\bm v^\psi}\adj
\\
&= \bb R_\bm v^\psi \pqty{
	1 - \i \bb P
} \pqty{\R_\bm v^\psi}\adj
= 1 - \i {\bb R_\bm v^\psi} \bb P {\pqty{\R_\bm v^\psi}\adj}.
\end{align}
$$
从而得到 $ \wt{\bb{P}} = \bb{R}_\bm v^\psi \bb P \bb R_\bm v^{-\psi} $.



## 参考文献

简单列一下主要参考的书和网站：

1. Tristan Needham 的《复分析：可视化方法》
2. https://www.zhihu.com/question/47736315
3. https://www.cnblogs.com/wtyuan/p/12324495.html
4. https://zhuanlan.zhihu.com/p/435306687

