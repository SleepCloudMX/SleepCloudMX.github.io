<h1 align="center">马尔科夫链</h1>

$$
% 设置
\newcommand{\aneg}[1]{\hspace{-0.75em}&#1&\hspace{-0.75em}}
\newcommand{\aneq}{\aneg{=}}
% 上述指令用于在使用 array 环境时调整等号左右间距
\newcommand{\eqs}{\quad\;}
% 上述指令用于 align 环境中, &= 的换行对齐时调整第二行位置
\renewcommand{\d}{\displaystyle}

% 字符
\renewcommand{\i}{\mathrm{i}}
\renewcommand{\j}{\mathrm{j}}
\renewcommand{\k}{\mathrm{k}}
\newcommand{\e}{\textup{e}}
\newcommand{\ve}{\varepsilon}
\newcommand{\Beta}{\mathit{B}}
\newcommand{\omicron}{\mathit{o}}
\newcommand{\Omicron}{\mathit{O}}

% 原本的定义为:
% \newcommand{\cal}[1]{\mathcal{#1}}
\newcommand{\bm}[1]{\boldsymbol{#1}}
\renewcommand{\cal}[1]{\mathcal#1}
\renewcommand{\scr}[1]{\mathscr#1}
\renewcommand{\frak}[1]{\mathfrak#1}
\newcommand{\bb}[1]{\mathbb#1}

% 数集
\newcommand{\D}{\mathbb{D}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\J}{\mathbb{J}}
\newcommand{\K}{\mathbb{K}}
\renewcommand{\L}{\mathbb{L}}

% 上下标
\newcommand{\trans}{^\mathrm{T}}
\newcommand{\inv}{^{-1}}
\newcommand{\madj}[1]{^{\pqty{#1^*}}}	% m 重伴随矩阵
\newcommand{\adj}{^*}
\newcommand{\vector}[1]{\overrightarrow{#1}}
\newcommand{\wavy}[1]{\overset\sim#1}	% \tilde 或 \widetilde 不明显, 容易与 \bar 或 \overline 混淆

% 序列
\newcommand{\ccdots}{\cdot\cdots\cdot}
\newcommand{\oneton}{1,2,\cdots,n}
\newcommand{\oneto}[1]{1,2,\cdots,#1}

\newcommand{\ssto}[3]{#1_1 #3 #1_2 #3 \cdots #3 #1_{#2}}
\newcommand{\ssup}[3]{#1^1 #3 #1^2 #3 \cdots #3 #1^{#2}}
\newcommand{\soneto}[2]{\ssto{#1}{#2}{,}}
\newcommand{\splus}[2]{\ssto{#1}{#2}{+}}

% 括号
\newcommand{\aqty}[1]{\expval{#1}}
\newcommand{\pbqty}[1]{\left(#1\right]}
\newcommand{\bpqty}[1]{\left[#1\right)}
\newcommand{\floor}[1]{\left\lfloor#1\right\rfloor}
\newcommand{\ceil}[1]{\left\lceil#1\right\rceil}

% 矩阵宏简写
\newcommand{\bmatrix}[1]{\begin{bmatrix}#1\end{bmatrix}}
\newcommand{\Bmatrix}[1]{\begin{Bmatrix}#1\end{Bmatrix}}
\newcommand{\vmatrix}[1]{\begin{vmatrix}#1\end{vmatrix}}
\newcommand{\Vmatrix}[1]{\begin{Vmatrix}#1\end{Vmatrix}}

% 常用微分
\newcommand{\dx}{\dd{x}}
\newcommand{\dy}{\dd{y}}
\newcommand{\dz}{\dd{z}}
\newcommand{\dt}{\dd{t}}
\newcommand{\ds}{\dd{s}}
\newcommand{\dr}{\dd{r}}

% 一般的微分
% 如果只使用 \dd{x}\dd{y} 的话, 中间会有多余的间隔.
\newcommand{\df}{\dd}
\newcommand{\ddf}[2]{\,\mathrm{d}#1\mathrm{d}#2}	% 微分形式 differential form
\newcommand{\dddf}[3]{\,\mathrm{d}#1\mathrm{d}#2\mathrm{d}#3}

% 高阶微分
\newcommand{\dxdy}{\ddf{x}{y}}
\newcommand{\dydz}{\ddf{y}{z}}
\newcommand{\dzdx}{\ddf{z}{x}}
\newcommand{\dudv}{\ddf{u}{v}}
\newcommand{\drdt}{\ddf{r}{\theta}}
\newcommand{\dxdydz}{\dddf{x}{y}{z}}

% 矩阵的宏指令
\newcommand{\pmcmn}[3]{\begin{pmatrix}
	#1_{11} & #1_{12} & \cdots & #1_{1#3} \\
	#1_{21} & #1_{22} & \cdots & #1_{n#3} \\
	\vdots & \vdots && \vdots \\
	#1_{#2 1} & #1_{#2 2} & \cdots & #2_{n#3} \\
\end{pmatrix}}

\newcommand{\pmc}[1]{\pmcmn{#1}{n}{n}}
\newcommand{\pvcn}[2]{\begin{pmatrix}
	#1_1 \\ #1_2 \\ \vdots \\ #1_{#2}
\end{pmatrix}}

\newcommand{\pvc}[1]{\pvcn{#1}{n}}
\newcommand{\pto}{\overset{P}{\to}}

% 函数名
\renewcommand{\char}{\operatorname{char}}	% 由于已存在此命令, 不可使用 DeclareMathOperator
\renewcommand{\r}{\operatorname{r}}
\DeclareMathOperator{\st}{s.t.\,}	% 虽然不是函数名, 但用了这个指令就放这儿了.
\DeclareMathOperator{\diag}{diag}	% 不需要定义太多, 一个文件里用到什么定义什么,
\DeclareMathOperator{\Ker}{Ker}		% 毕竟特殊的函数名太多太多了.
\DeclareMathOperator{\Aut}{Aut}		% 便捷与效率的权衡.
\DeclareMathOperator{\Inn}{Inn}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\SL}{SL}
\DeclareMathOperator{\stab}{stab}
\DeclareMathOperator{\orb}{orb}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\Cov}{Cov}
\DeclareMathOperator{\Corr}{Corr}
\DeclareMathOperator{\rot}{rot}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\Outer}{Outer}
\DeclareMathOperator{\Even}{Even}
\DeclareMathOperator{\Scalar}{Scalar}
\DeclareMathOperator{\Vector}{Vector}
\DeclareMathOperator{\arsh}{arsh}
\DeclareMathOperator{\arch}{arch}
\DeclareMathOperator{\arth}{arth}
\renewcommand{\Re}{\operatorname{Re}}	% 自带 \Re 的效果是 \mathrm{Re}, 前后无空格, 故重写
\renewcommand{\Im}{\operatorname{Im}}
\DeclareMathOperator{\Sa}{Sa}
\DeclareMathOperator{\Si}{Si}

% 运算符
% 可以用 \bigcap, \bigcup, \bigoplus, \bigotimes 替代
\newcommand{\capop}{\displaystyle\mathop\cap\limits}
\newcommand{\cupop}{\displaystyle\mathop\cup\limits}
\newcommand{\oplusop}{\mathop\oplus\limits}
\newcommand{\otimesop}{\mathop\otimes\limits}
\newcommand{\bigoplusop}{\mathop\bigoplus\limits}
\newcommand{\bigotimesop}{\mathop\bigotimes\limits}

% 积分
\newcommand{\dint}{\displaystyle\int}
\newcommand{\inti}{\dint_{-\infty}^{+\infty}}
\newcommand{\intoi}{\dint_0^{+\infty}}

\newcommand{\intl}{\displaystyle\int\limits}
\newcommand{\iintl}{\displaystyle\iint\limits}
\newcommand{\iiintl}{\displaystyle\iiint\limits}

% 求和
\newcommand{\dsum}{\displaystyle\sum}
\newcommand{\csum}[1]{\dsum_{#1=1}^\infty}
\newcommand{\nsum}{\csum{n}}
\newcommand{\ksum}{\csum{k}}
\newcommand{\nosum}{\dsum_{n=0}^\infty}
\newcommand{\insum}{\dsum_{i=1}^n}
\newcommand{\knsum}{\dsum_{k=1}^n}

% 求积
\newcommand{\dprod}{\displaystyle\prod}
\newcommand{\nprod}{\dprod_{n=1}^\infty}
\newcommand{\noprod}{\dprod_{n=0}^\infty}
\newcommand{\inprod}{\dprod_{i=1}^n}

% 极限
\newcommand{\liml}{\lim\limits}
\newcommand{\ulim}{\overline\lim\limits_{n\to\infty}}
\newcommand{\dlim}{\underline\lim\limits_{n\to\infty}}
% 注意这里的 d 是 down, 而不是 displaystyle

\newcommand{\xlim}{\lim\limits_{x\to x_0}}
\newcommand{\nlim}{\lim\limits_{n\to\infty}}
\newcommand{\clim}[1]{\lim\limits_{#1\to\infty}}

% 并集
\newcommand{\incup}{\bigcup_{i=1}^n}
\newcommand{\ncup}{\bigcup_{n=1}^\infty}
\newcommand{\icup}{\bigcup_{i=1}^\infty}

% 交集
\newcommand{\incap}{\bigcap_{i=1}^n}
\newcommand{\ncap}{\bigcap_{n=1}^\infty}
\newcommand{\icap}{\bigcap_{i=1}^\infty}

% 差分
\newcommand{\DD}{\Delta}
\newcommand{\DV}[2]{\dfrac{\DD#1}{\DD#2}}
\newcommand{\nDV}[3]{\dfrac{\DD^{#1}#2}{\DD#3^{#1}}}

% 求导
\newcommand{\ddv}{\displaystyle\dv}
\newcommand{\dpdv}{\displaystyle\pdv}

% 缩写
\newcommand{\LRA}{\Leftrightarrow}
\newcommand{\RLA}{\Leftrightarrow}
\newcommand{\LA}{\Leftarrow}
\newcommand{\RA}{\Rightarrow}

\newcommand{\lra}{\leftrightarrow}
\newcommand{\rla}{\leftrightarrow}
\newcommand{\la}{\leftarrow}
\newcommand{\ra}{\rightarrow}

\newcommand{\QRLA}{\quad\RLA\quad}
\newcommand{\QRA}{\quad\RA\quad}
\newcommand{\LLRA}{\Longleftrightarrow}

\newcommand{\QNRA}{\quad\nRightarrow\quad}
\newcommand{\qnra}{\quad\nrightarrow\quad}

\newcommand{\wt}{\widetilde}

% 图形符号
\newcommand{\qed}{\quad\square}
\renewcommand{\parallel}{\mathrel{/\mskip-2.5mu/}}
\newcommand{\paralleleq}{\hspace{0.5em}{^{^{\parallel}}}\hspace{-1.04em}=}
\newcommand{\rt}{\matrm{Rt}\triangle}

% 分块矩阵
\newenvironment{mat}[1]{
	\begin{array}{#1}
}{
	\end{array}
}

\newenvironment{pmat}[1]{
	\left( \begin{array}{#1}
}{
	\end{array} \right)
}

\newenvironment{bmat}[1]{
	\left[ \begin{array}{#1}
}{
	\end{array} \right]
}

\newenvironment{Bmat}[1]{
	\left\{ \begin{array}{#1}
}{
	\end{array} \right\}
}

\newenvironment{vmat}[1]{
	\left\lvert \begin{array}{#1}
}{
	\end{array} \right\rvert
}

\newenvironment{Vmat}[1]{
	\left\lVert \begin{array}{#1}
}{
	\end{array} \right\rVert
}
$$

[TOC]

### 3.1  马氏链的概念

#### 3.1.1  马尔科夫链的定义

**定义**	随机序列 $ \Bqty{X_n, n \ge 0} $ 若满足
$$
\begin{array}{l}
\forall i_0, i_1, \cdots, i_n, i_{n + 1} \in S = \N^+, n \in \N,
\\
\forall P\Bqty{X_0 = i_0, X_1 = i_1, \cdots, X_n = i_n} > 0:
\end{array}
$$

$$
P\Bqty{
	X_{n + 1} = i_{n + 1} \mid X_0 = i_0, \cdots, X_n = i_n
} = P\Bqty{
	X_{n + 1} = i_{n + 1} \mid X_n = i_n
}.
$$

则称为 **马尔科夫链** (M.C., Markov, Chains), 且上述性质称为马尔可夫性或无后效性.

**定义**	对于 $ \forall i, j \in S $, 称 $ P\Bqty{X_{n + 1} = j \mid X_n = i} \equiv p_{ij}(n) $ 为 $n$ 时刻的 **一步转移概率**. 若还有 $ p_{ij}(n) \equiv p_{ij} $, 则称 $ \Bqty{X_n, n \ge 0} $ 为 **齐次马氏链**. 记 $ \bm P = (p_{ij}) $ 为一步概率转移矩阵, 简称 **转移矩阵** (Transition matrix).

#### 3.1.1  独立随机变量和的序列

当 $ i \in \N $ 时, 令 $ a_i \ge 0 $, 其它情况下均为零, 且 $ \dsum_{i = 0}^{\infty} a_i = 1 $.

设独立同分布随机变量序列 $ \Bqty{\rho_n \in \N, n \ge 0} $ 满足 $ P\Bqty{\rho_n = i} = a_i $, 则其为马氏链.

令 $ X_0 = 0 $, $ X_n = \knsum \rho_k $, 则 $ \Bqty{X_n, n \ge 0} $ 也是一马氏链, 且 $ p_{ij} = a_{j - i} $.

#### 3.1.2  直线上的随机游动

##### 1  无限制的随机游动

令 $ X_0 = 0 $, 且 $ X_n - X_{n - 1} $ 相互独立, 并满足
$$
\begin{array}{|c|c|}
\hline
X_n - X_{n-1} & 1 & -1 & 0
\\ \hline
P & p & q & r
\\ \hline
\end{array}
$$

则 $ \Bqty{X_n, n \ge 0} $ 是一个马氏链.

状态的分类见[第三节](# 3.3.11  直线上随机游动).

##### 2  带吸收壁的随机游动

在无限制的随机游动基础上, 修改条件 $ p_{00} = p_{bb} = 1 $, 则为带两个吸收壁 $0$ 和 $b$ 的随机游动, 是一有限状态马氏链.

##### 3  带反射壁的随机游动

在无限制的随机游动基础上, 修改条件 $ p_{01} = p_{b, b - 1} = 1 $, 则为带反射壁 $ 0 $ 和 $ b $ 的随机游动.

##### 4  艾伦费斯特模型

令 $ S = \Bqty{-a, -a + 1, \cdots, -1, 0, 1, \cdots, a} $, 转移概率为
$$
\begin{cases}
	p_{i, i - 1} = \dfrac{1}{2} \pqty{1 + \dfrac{i}{a}},
	& -a + 1 \le i \le a - 1,
	\\
	p_{i, i + 1} = \dfrac{1}{2} \pqty{1 - \dfrac{i}{a}},
	& -a + 1 \le i \le a - 1,
	\\
	p_{a, a - 1} = 1,
	\\
	p_{-a, -a + 1} = 1,
	\\
	p_{ij} = 0.
\end{cases}
$$

#### 3.1.3  排队模型

##### 1  离散排队系统

设独立同分布随机变量序列 $ \Bqty{\xi_n \in \N, n \ge 1} $ 表示第 $n$ 个周期到达的顾客数, 服务台每个周期完成一个顾客的服务. 记第 $ n $ 周期开始的顾客数为 $ X_n $, 且 $ a^+ = \max\Bqty{a, 0} $, 则
$$
X_{n + 1} = (X_n - 1)^+ + \xi_n,
$$
且 $ \Bqty{X_n, n \ge 0} $ 是一个马氏链. 设 $ P\Bqty{\xi_n = k} = a_k \ge 0 $, $ \dsum_{k = 0}^\infty a_k = 1 $, 则转移概率为
$$
\begin{cases}
	p_{ij} = a_j, & i = 0, 1; j \ge 0, \\
	p_{ij} = a_{j + 1 - i}, & i > 1, j \ge i - 1, \\
	p_{ij} = 0, & i > 1, j < i - 1.
\end{cases}
$$
##### 2  G/M/1 排队系统

只有一个服务员, 顾客到达服务台的时间间隔独立同分布 $ G(x) $,

服务时间 $ M $ 独立同 $ E(\mu) $, 且与顾客到达过程独立. 则 $ \pbqty{0, t} $ 内服务完的顾客数服从 $ P(\mu) $.

记 $ X_n $ 表示第 $ n $ 个顾客到达服务台时系统内的顾客数, $ T_n $ 表示第 $ n $ 个顾客到达时刻, 则 $ \Bqty{X_n, n \ge 1} $ 为马氏链.

令 $ A = \Bqty{X_n = i, X_{n + 1} = i + 1 - j}\ (0 \le j \le i) $, 则
$$
\begin{align}
p_{i, i + 1 - j} &= P\Bqty{A \mid X_n = i}
\\
&= \intoi P\Bqty{
	A \mid X_n = i, T_{n + 1} - T_n = t
} \dd{G(t)}
\\
&= \intoi \dfrac{
	\e^{-\mu t} (\mu t)^j
}{j!} \dd{G(t)}.
\end{align}
$$
服务台由 $ i $ 个顾客转为空闲的概率, 则
$$
\begin{align}
p_{i0} &= 
\intoi \sum_{k = i + 1}^\infty
\dfrac{
	\e^{-\mu t} (\mu t)^k
}{k!} \dd{G(t)}.
\end{align}
$$
#### 3.1.4  离散分支过程

设群体某一代的每个个体产生的下一代个体数为相互独立的随机变量 $ \xi \in \N $,

且 $ P\Bqty{\xi = k} = a_k \ge 0, k \ge 0, \dsum_{k = 0}^\infty a_k = 1 $, 记 $ X_n $ 表示第 $n$ 代个体的数目, 则
$$
X_{n + 1} = \begin{cases}
	0, & X_n = 0, \\
	\splus{\xi}{n}, & X_n \ge 1.
\end{cases}
$$
于是 $ \Bqty{X_n, n \ge 1} $ 是马氏链, 且
$$
\begin{align}
p_{ij} &= P\Bqty{
	X_{n + 1} = j \mid X_n = i
} \\
&= P\Bqty{
	\splus{\xi}{X_n} \mid X_n = i
} \\
&= P\Bqty{
	\splus{\xi}{i} = j
} \\
&= \eval{
	\dfrac{
		\partial^j \pqty{
			\sum_{k = 0} a_k x^k
		}^j
	}{j! \partial x^j}
}_{x = 0}.
\end{align}
$$
最后一步由[母函数](https://sleepcloudmx.github.io/Math/概统/概率论/概率论.pdf#3.5.4 母函数的定理)得到.

#### 3.1.5  马尔科夫链的检验

**定理 3.1.1**	设随机过程 $ \Bqty{X_n,n \ge 0} $ 满足

1. 独立同分布随机变量 $ \Bqty{\xi_n, n \ge 1} $ 与 $ X_0 $ 也独立.
2. $ f: S \times S \to S, (X_{n-1}, \xi_n) \mapsto X_n %= f(X_{n - 1}, \xi_n) $.

则 $ \Bqty{X_n,n \ge 0} $ 是马尔科夫链, 且 $ p_{ij} = P\Bqty{f(i, \xi_1) = j} $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.1.1 马尔科夫链的构造与检验.html" height=220></iframe>
    </details>
</div>


### 3.2  转移概率矩阵

#### 3.2.1  随机矩阵与初始分布

**定义**	称矩阵 $ \bm A = (a_{ij})_{S \times S} $ 为 **随机矩阵**, 如果

1. $ \forall i, j \in S: a_{ij} \ge 0 $,
2. $ \forall i \in S: \sum_{j \in S} a_{ij} = 1 $.

**定义**	定义马氏链的概率分布向量为
$$
\begin{align}
\pi_i(n) &= P\Bqty{X_n = i}, \\
\pi(n) &= \pqty{
	\pi_1(n), \cdots, \pi_i(n)
}.
\end{align}
$$
并称 $ \pi(0) $ 为马氏链的初始分布.

**备注**	马氏链的特性完全由它的一步转移概率矩阵 $P$ 与初始分布向量 $ \pi(0) $ 决定, 且
$$
P\Bqty{
	X_0 = i_0, \cdots, X_n = i_n
} = \pi_{i_0}(0) p_{i_0 i_1} p_{i_1 i_2} \cdots p_{i_{n-1} i_n}.
$$
**定理 3.2.1**	
$$
\pi(n + 1) = \pi(n) \bm P = \pi(0) \bm P^n.
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.2.1 概率分布向量与转移矩阵.html" height=220></iframe>
    </details>
</div>
#### 3.2.2  CK 方程

**定义**	称 $ p_{ij}^{(m)} = P\Bqty{X_{n + m} = j \mid X_n = i} $ 为 $m$ 步转移概率, $ \bm P^{(m)} = (p_{ij}^{(m)}) $ 为 $m$ 步转移概率矩阵. 约定 $ p_{ii}^{(0)} = 0 $.

**定理 3.2.2 (Chapman-Kolmogorov 方程)**	
$$
\bm P^{(m + n)} = \bm P^{m + n} = \bm P^m \bm P^n = \bm P^{(m)} \bm P^{(n)}.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.2.2 Chapman-Kolmogorov 方程.html" height=350></iframe>
    </details>
</div>


### 3.3  状态的分类

#### 3.3.1  状态相关定义

**定义**	

- 吸收

  - 若 $ p_{ii} = 1 $, 则称状态 $ i \in S $ 为 **吸收态** (absorbing), 其集合记为 $ A $.
  - 若 $ p_{ii} < 1 $, 则称状态 $ i \in S $ 为 **过渡态** (transient), ~~其集合记为 $T$.~~

- 可达

  - 对 $ i, j \in S $, 若 $ \exist n \in \N: p_{ij}^{(n)} > 0 $, 则称自状态 $i$ 出发可达状态 $j$, 记为 $ i \to j $.
  - 若从状态 $ i $ 通过 $n$ 步可达 $ j $, 则记为 $ i \overset{(n)}{\to} j $.
  - 若 $ i \to j $ 且 $ j \to i $, 则称 $ i, j $ **相通**, 记为 $ i \rla j $.

- 首达

  - 若 $ i \to j $, 则定义 **首达时间** 为
    $$
    T_{ij} = \min\Bqty{
    	n : n \ge 1, X_n = j, X_0 = i
    }.
    $$
    否则记 $ T_{ij} = \infty $.

  - 定义 **首达概率** 为
    $$
    \begin{align}
    f_{ij}^{(n)} &= P\Bqty{T_{ij} = n \mid X_0 = i}
    \\
    &= P\Bqty{
    	X_n = j, X_k \ne j, 1 \le k \le n - 1 \mid X_0 = i
    }.
    \end{align}
    $$
    约定 $ f_{ii}^{(0)} = 0, p_{ii}^{(0)} = 1 $, 并定义有限步首达的概率为 $ f_{ij} = \nsum f_{ij}^{(n)} $.

  - 注意 $ f_{ij} $ 不是 $ f_{ij}^{(1)} $.

- 若 $ f_{ii} = 1 $,

  - 则称 $i$ 为 **常返状态**, 否则称为 **非常返状态** (或 **瞬时状态**).
  - 记 $ \mu_i = \nsum n f_{ii}^{(n)} $, 若有限, 则称 $ i $ 为 **正常返态**, 否则称为 **零常返态**.

- 周期

  - 若 $ S_\text{回转时间} = \Bqty{n : n \ge 1, p_{ii}^{(n)} > 0} \ne \varnothing $, 则称该数集的最大公约数 $ d(i) $ 为状态 $ i $ 的 **周期**.
  - 若 $ d(i) > 1 $, 则称 $ i $ 是 **周期的**; 若 $ d(i) = 1 $, 则称 $ i $ 为 **非周期的**.
  - 若状态 $ i $ 正常返且非周期, 则称 $ i $ 为 **遍历状态**.

- 备注

  - 若 $ S_{回转时间} \ne \varnothing $, 则其有可数无穷个元素.
  - 若 $ n_1, n_2 \in S_{回转时间} $, 则 $ \forall k \in \N^+ \colon kn_1, n_1 + n_2 \in S_{回转时间} $.
  - $ d(i) $ 不一定属于 $ S_{回转时间} $, 其整数倍亦然.
  - 对于 $ \forall \Bqty{a_n \in \N^+, n \in \N^+} $, 可构造马氏链使得 $ S_{回转时间} $ 等于 $ \Bqty{a_n} $ 在加法下生成的集合.


[MATLAB 马氏链分析工具_matlab asymptotics_leida_wt的博客-CSDN博客](https://blog.csdn.net/leida_wt/article/details/107504137)

#### 3.3.2  吸收态的性质

**定理 3.3.0**	设从状态 $ i \in S $ 落入吸收态 $ k \in A $ 的概率为 $ q_{ik} $, 则 $ q_{ik} $ 及其期望 $ \mu_i $ 由下列方程组给出 (求和号表示方程的联立)

1. $ \dsum_{i \in T}: q_{i k} = p_{i k} + \sum_{j \in T} p_{i j} q_{jk} $.
2. $ \dsum_{i \in T}: \mu_i = 1 + \sum_{j \in T} p_{ij} \mu_j $.

**[证明](https://zhuanlan.zhihu.com/p/141788195)**	

#### 3.3.3  可达与首达

**定理 3.3.1**	对于 $ \forall i, j \in S, n \in \N^+ $, 有

1. $ p_{ij}^{(n)} = \ksum f_{ij}^{(k)} p_{jj}^{(n-k)} $.
2. $ f_{ij}^{(n)} = \begin{cases}
   	\dsum_{k \ne j} f_{kj}^{(n-1)} p_{ik}, & n > 1
   	\\
   	p_{ij}, & n = 1.
   \end{cases}
   % \dsum_{k \ne j} f_{kj}^{(n-1)} p_{ik} I_\Bqty{n > 1} + p_{ij} I_\Bqty{n = 1} $ 
3. $ i \to j \RLA f_{ij} > 0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.1 n 步转移概率与首达概率.html" height=600></iframe>
    </details>
</div>
**引理 1**	记 $ \Bqty{p_{ii}^{(n)}} $ 和 $ \Bqty{f_{ii}^{(n)}} $ 的母函数分别为 $ P(\rho) = \nosum p_{ii}^{(n)} \rho^n $ 和 $ F(\rho) = \nosum f_{ii}^{(n)} \rho^n $, 则
$$
P(\rho) = \dfrac{1}{1 - F(\rho)}, \quad 0 \le \rho < 1.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.2 引理 1 母函数.html" height=270></iframe>
    </details>
</div>
#### 3.3.4  常返与非常返

**定理 3.3.2**	

1. 状态 $i$ 为常返态, 当且仅当 $ \nosum p_{ii}^{(n)} = \infty $.
2. 状态 $ i $ 为非常返态, 当且仅当 $ \nosum p_{ii}^{(n)} = \dfrac{1}{
   	1 - f_{ii}
   } < \infty $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明
        </b></summary>
        <iframe src="ifsrc\3.3.2 常返态的判断.html" height=400></iframe>
    </details>
</div>
**备注**	令 $ S(i) = \nosum I_\Bqty{X_n = i} $ 表示马氏链到达 $i$ 的次数, 于是 $ E\bqty{S(i) \mid X_0 = i} = \nosum p_{ii}^{(n)} $.

**推论 1**	若 $ j $ 非常返, 则对于 $ \forall i \in S $,

1. $ \nsum p_{ij}^{(n)} < \infty $.
2. $ \nlim p_{ij}^{(n)} = 0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.2 推论 1 非常返态.html" height=450></iframe>
    </details>
</div>

**推论 2**	若 $ j $ 为常返态, 则

1. 当 $ i \to j $ 时, $ \nsum p_{ij}^{(n)} = \infty $.
2. 当 $ i \not\to j $ 时, $ \nsum p_{ij}^{(n)} = 0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.2 推论 2 常返态.html" height=230></iframe>
    </details>
</div>
#### 3.3.5  无穷多次到达

**定理 3.3.3**	记
$$
\begin{align}
S_m(j) &= \dsum_{n = m}^\infty I_\Bqty{X_n = j},
\\
g_{ij} &= P\Bqty{
	S_1(j) = +\infty \mid X_0 = i
} \\
&= P\Bqty{
	S_{m + 1}(j) = +\infty \mid X_m = i
},
\end{align}
$$
则
$$
\forall i, j \in S:
g_{ij} = f_{ij} I_\Bqty{j\ 常返}.
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.3 常返态与非常返态的判断.html" height=600></iframe>
    </details>
</div>
**定理 3.3.4**	由定理 3.3.3 即得:

1. 状态 $ i $ 常返 $ \RLA g_{ii} = 1 $.
2. 状态 $ i $ 非常返 $ \LRA g_{ii} = 0 $.

**备注**

- 若 $ i $ 常返, 则几乎所有样本轨道无穷多次回到 $ i $.
- 若 $ i $ 非常返, 则几乎所有样本轨道有限次回到 $ i $.

#### 3.3.6  平均到达时间

**引理**	设正项级数 $ A(z) = \nosum a_n z^n $ 在 $ \bpqty{0, 1} $ 收敛, 则
$$
\nlim \dfrac{\splus{a}{n}}{n} = \lim_{z \to 1-} (1 - z) A(z).
$$
**备注**	该引理为实分析中的结果, 由 Hardy 与 Littlewood 给出.

**定理 3.3.5**	设 $ \Bqty{X_n, n \ge 0} $ 是一常返的马氏链, 即状态空间 $ S $ 是单一的常返类, 则对于 $ \forall i, j \in S $, 有
$$
\nlim \dfrac{1}{n + 1} \sum_{k=0}^n p_{ij}^{(k)} = \dfrac{1}{\mu_{ij}}.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.5 常返的平均步数.html" height=320></iframe>
    </details>
</div>
**方法**	计算平均到达时间, 有如下思路

1. 计算 $ \mu_{ij} $ 的分布, 从而求得期望.
2. 计算 $ \nlim \bm P^{(n)} $, 从而由定理 3.3.5 和下一节的引理得到.
3. 由递推式, 对于有 $ n $ 个元素的状态空间, 列出 $ n^2 $ 个方程的线性方程组.

#### 3.3.7  平均回转时间

**引理**	若极限 $ \nlim a_n $ 存在, 则
$$
\nlim a_n = \nlim \dfrac{1}{n} \sum_{k=1}^n a_n.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.6 引理.html" height=350></iframe>
    </details>
</div>
**定理 3.3.6**	设 $ i $ 常返且周期为 $ d $, 则
$$
\nlim p_{ii}^{(nd)} = \dfrac{d}{\mu_i},
$$
其中 $ \mu_i $ 为 $ i $ 的平均回转时间. 当 $ \mu_i = +\infty $ 时, 右式理解为 0.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.6 引理.html" height=350></iframe>
    </details>
</div>
#### 3.3.8  零常返与遍历

**定理 3.3.7**	设 $ i $ 常返, 则

1. $ i $ 零常返, 当且仅当 $ \nlim p_{ii}^{(n)} = 0 $.
2. $ i $ 为遍历, 当且仅当 $ \nlim p_{ii}^{(n)} = \dfrac{1}{\mu_i} > 0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.7 常返时零常返与遍历的充要条件.html" height=330></iframe>
    </details>
</div>
#### 3.3.9  相通与不可约链

**性质**	相通关系 '$ \rla $' 为等价关系, 即

1. 自反性: $ i \rla i $.
2. 对称性: $ i \rla j \RA j \rla i $.
3. 传递性: $ i \rla j \and j \rla k \RA i \rla k $.

**定义**	若一马氏链的所有状态属于同一等价类, 则称它是 **不可约链**.

**定理 3.3.8**	若 $ i $ 常返, 且 $ i \to j $, 则 $ j $ 常返, 且 $ f_{ji} = 1 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.8 常返与可达.html" height=600></iframe>
    </details>
</div>

**定理 3.3.9**	若 $ i \rla j $, 则

1. $ i $ 与 $ j $ 同为非常返, 或同为正常返, 或同为零常返.
2. $ i $ 与 $ j $ 同为非周期, 或有相同的周期.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.9 相通的状态相同.html" height=600></iframe>
    </details>
</div>

#### 3.3.10  常返态等价命题

**定理 3.3.10**	下列命题等价:

1. $ i $ 为常返态 (即 $ f_{ii} = 1 $).
2. $ P\Bqty{\ncup\Bqty{X_n = i} \mid X_0 = i} = 1 $.
3. $ P\Bqty{S_1(i) = +\infty \mid X_0 = i} = 1 $.
4. $ \nsum p_{ii}^{(n)} = +\infty $.
5. $ E\Bqty{S_1(i) \mid X_0 = i} = +\infty $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.10 常返的五个等价条件.html" height=520></iframe>
    </details>
</div>
---

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>马氏链状态分类的总结
        </b></summary>
        <img src="image\3.3 状态的分类.png" />
    </details>
</div>

#### 3.3.11  直线上随机游动

<span style="border-left: 4px solid #dfe2e5; padding: 0 15px; color: #777777; padding-right: 0;">直线上年无限制的随机游动的[定义](# 1  无限制的随机游动).</span>

**命题 3.3.11**	直线上的随机游动构成马氏链, 并且是周期为 2 的不可约链. 该马氏链中 $ \Z $ 构成一个等价类, 当 $ p = \dfrac{1}{2} $ 时为常返类, 否则为非常返类.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.11 直线上随机游动.html" height=530></iframe>
    </details>
</div>

#### 3.3.12  高维的随机游动

**定义**	令 $ X_0 = (0, 0) $, 且 $ X_n - X_{n - 1} $ 相互独立, 并满足
$$
\begin{array}{|c|c|c|}
\hline
X_n - X_{n-1} & (1, 0) & (0, 1) & (-1, 0) & (0, -1)
\\ \hline
P & 0.25 & 0.25 & 0.25 & 0.25
\\ \hline
\end{array}
$$

则 $ \Bqty{X_n, n \ge 0} $ 称为平面上的对称随机游动. 高维对称随机游动类似定义.

**命题 3.3.12**	高维对称随机游动构成马氏链, 并且是周期为 2 的不可约链.

**引理 3.3.13**	$ \dsum_{k = 0}^n \binom{n}{k}^2 = \binom{2n}{n} $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.13 引理-组合公式.html" height=60></iframe>
    </details>
</div>
**命题 3.3.13**	在平面对称随机游动中, $ \Z^2 $ 构成一个<u>常返类</u>.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.3.13 平面对称随机游动.html" height=350></iframe>
    </details>
</div>

**定理 3.3.14 (Polya 定理)**	在 $ d $ 维空间对称随机游动中, $ \Z^d $ 构成一个<u>非常返类</u>.

[**证明**](https://www.zhihu.com/question/67585992)



### 3.4  状态空间的分解

#### 3.4.1  闭集与不可约

**定义**	若 $ \forall i \in C \subset S, j \notin C: i \not\ra j $, 则称 $ C $ 是 **闭集**. 若 $ \forall i, j \in C: i \rla j $, 则称该闭集 **不可约**.

**引理**	$ C $ 是闭集的充要条件为, $ \forall i \in C, j \not\in C, n \in \N^+: p_{ij}^{(n)} = 0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.4.1 引理.html" height=150></iframe>
    </details>
</div>
**定理 3.4.1**	所有常返状态构成一闭集.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.4.1 所有常返态构成一闭集.html" height=60></iframe>
    </details>
</div>
**备注**	之后用 $C$ 表示所有常返态的闭集, 用 $T$ 表示所有非常返态的集合.

**推论**	不可约马氏链全为非常返态, 或全为零常返态, 或全为正常返态. (也可以由定理 3.3.9 得到)

#### 3.4.2  常返态的分解

**定理 3.4.2**	若 $ C \ne \varnothing $, 则存在不交闭集序列 $ \Bqty{C_n} $, 使得 $ C = C_1 \cup C_2 \cup \cdots $, 且有

1. $ C_n $ 中任两状态相通.
2. $ C_h \cap C_l = \varnothing, h \ne l $.

其中 $ C_n\ (n \in \N^+) $ 均为互不相通闭集, 称为基本常返闭集.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.4.2 常返态闭集的不交闭集分解.html" height=175></iframe>
    </details>
</div>

**推论**	状态空间 $S$ 可分解为
$$
S = T \cup C = T \cup C_1 \cup C_2 \cup \cdots,
$$
其中 $ \Bqty{C_h} $ 为基本常返闭集, $T$ 不一定是闭集.

**备注**	若系统从某非常返状态出发, 则可能一直在非常返集 $T$ 中运动, 也可能进入某一基本常返闭集 $ C_h $ 中并一直在其中运动.

**定理 3.4.3**	若 $S$ 为有限集, 则 $T$ 一定是非闭集.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.4.3 有限集的非常返态非闭.html" height=60></iframe>
    </details>
</div>

**推论**	有限不可约马氏链的状态都是常返的, 即 $ T = \varnothing, S = C $.

#### 3.4.3  分解概率矩阵

**引理 1**	设 $ C_h \subset S $ 为闭集, 则 $ C_h $ 上的转移子矩阵 $ \bm P_n^{(m)} = (p_{ij}^{(m)}), i, j \in C_h $ 为随机矩阵.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.4.4 引理 1.html" height=170></iframe>
    </details>
</div>

**引理 2**	若将转移概率矩阵分解为 $ S = C_1 \cup C_2 \cup \cdots \cup C_h \cup T_{h + 1} \cup \cdots \cup T_{n} $, 其中任一等价类中的状态可达且仅可达该等价类或前面的等价类中的状态. 于是, 转移概率矩阵可分解为
$$
\bm P = \begin{bmatrix}
	\bm P_1 & \bm 0 & \cdots & \bm 0 & \bm 0 & \cdots & \bm 0 \\
	\bm 0 & \bm P_2 & \cdots & \bm 0 & \bm 0 & \cdots & \bm 0 \\
	\vdots & \vdots & \ddots & \vdots & \vdots & \ddots & \vdots \\
	\bm 0 & \bm 0 & \cdots & \bm P_h & \bm 0 & \cdots & \bm 0 \\
	\bm R_{h + 1, 1} & \bm R_{h + 1, 2} & \cdots & \bm R_{h + 1, h} & \bm Q_{h + 1} & \cdots & \bm 0 \\
	\vdots & \vdots & \ddots & \vdots & \vdots & \ddots & \vdots \\
	\bm R_{n, 1} & \bm R_{n, 2} & \cdots & \bm R_{n, h} & \bm R_{n, h + 1} & \cdots & \bm Q_n
\end{bmatrix}
= \begin{bmatrix}
	\bm P_C & 0 \\
	\bm R & \bm Q_T
\end{bmatrix}.
$$

**定理 3.4.4**	若转移概率矩阵按上述形式分解, 则

1. $ \bm P_{l} (1 \le l \le h) $ 是局限在 $ C_l $ 上的随机矩阵.
2. $ \bm P^n = \begin{bmatrix} \bm P_C^n & \bm 0 \\ \bm R_n & \bm Q_T^n \end{bmatrix} $, 其中 $ \bm R_1 = \bm R $, $ \bm R_n = \bm R_{n-1} \bm P_C + \bm Q_T^{n-1} \bm R $.
3. $ \nlim \bm Q_T^n = \bm 0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.4.4 转移概率矩阵分解后的性质.html" height=450></iframe>
    </details>
</div>



### 3.5  $ \boldsymbol P^n $ 的极限性态与平稳分布

#### 3.5.1  $ \boldsymbol P^n $ 的极限形态

欲求 $ \nlim P\Bqty{X_n = i} \equiv \nlim \pi_i(n) $, 可研究 $ \nlim p_{ij}^{(n)} $.

##### 1  $ j $ 非常返或零常返

**定理 3.5.1**	若 $ j $ 非常返或零常返, 则
$$
\forall i \in S: \nlim p_{ij}^{(n)} = 0.
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.5.1 非常返或零常返的概率极限.html" height=300></iframe>
    </details>
</div>
**推论 1**	有限马氏链没有零常返状态, 并且总存在正常返状态.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.5.1 推论 1.html" height=100></iframe>
    </details>
</div>
**推论 2**	不可约的有限马氏链的状态都是正常返的.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.5.1 推论 2.html" height=60></iframe>
    </details>
</div>
**推论 3**	若马氏链有一零常返态, 则必有无穷多个零常返态.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.5.1 推论 3.html" height=60></iframe>
    </details>
</div>

##### 2  $ j $ 为正常返态

**定理 3.5.2**	若 $ j $ 正常返, 且周期为 $ d $, 则对于 $ \forall i \in S, 0 \le r \le d - 1 $, 有
$$
\nlim p_{ij}^{(nd + r)} = f_{ij}(r) \dfrac{d}{\mu_j},
$$
其中 $ f_{ij}(r) = \dsum_{m=0}^\infty f_{ij}^{(md + r)}, 0 \le r \le d - 1 $.

**证明**	略.

**推论 1**	若 $ j $ 遍历, 则对 $ \forall i \in S $, 有
$$
\nlim p_{ij}^{(n)} = \dfrac{f_{ij}}{\mu_j}.
$$

**推论 2**	对于不可约的遍历链 (即所有状态遍历), 对 $ \forall i, j \in S $, 有
$$
\nlim p_{ij}^{(n)} = \dfrac{1}{\mu_j}.
$$
**定理 3.5.3**	若 $ j $ 常返, 则 $ \forall i \in S $, 有
$$
\nlim \dfrac{1}{n} \knsum p_{ij}^{(k)} = \dfrac{f_{ij}}{\mu_j}.
$$
**备注**	定理 3.5.2 的推论 1 是定理 3.5.3 的特例.

**推论**	如不可约马氏链的状态是常返的, 则 $ \forall i, j \in S $, 有
$$
\nlim \dfrac{1}{n} \knsum p_{ij}^{(k)} = \dfrac{1}{\mu_j}.
$$
**定理 3.5.4**	若对于不可约的遍历链, $ \Bqty{\pi_i = \dfrac{1}{\mu_i}} $ 是方程组
$$
x_j = \sum_{i \in S} x_i p_{ij}
$$
满足条件 $ x_j \ge 0, j \in S, \sum_{j \in S} x_j = 1 $ 的唯一解.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.5.4 方程组的解.html" height=600></iframe>
    </details>
</div>

#### 3.5.2  平稳分布

**定义**	若定义在 $S$ 上的概率分布 $ \bm \pi = \Bqty{\pi_1, \pi_2, \cdots} $ 满足 $ \bm \pi = \bm \pi \bm P $, 即
$$
\pi_j = \sum_{i \in S} \pi_i p_{ij},
$$
则称为 **马氏链的平稳分布** (或不变概率测度).

**备注**	对于一个平稳分布, 有 $ \bm \pi = \bm \pi \bm P^n $.

**定理 3.5.5**	设 $ \Bqty{X_n, n \ge 0} $ 是马氏链, 则其为平稳过程的充要条件是 $ \bm \pi(0) = \Bqty{\pi_i(0), i \in S} $ 是平稳分布, 即 $ \bm \pi(0) = \bm \pi(0) \bm P $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.5.5 平稳过程与平稳分布.html" height=600></iframe>
    </details>
</div>
**定理 3.5.6**	不可约遍历链恒有唯一的平稳分布 $ \Bqty{\pi_i = \dfrac{1}{\mu_i}} $, 且 $ \pi_j = \nlim p_{ij}^{(n)} $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.5.6 不可约遍历链的平稳分布.html" height=140></iframe>
    </details>
</div>
**定理 3.5.7**	令 $ C_+ $ 为马氏链中全体正常返态构成的集合, 于是有

1. 不存在平稳分布 $ \RLA C_+ = \varnothing $.
2. 平稳分布唯一存在 $ \RLA $ 只有一个基本正常返闭集 $ C_+ $.
3. 有限状态马氏链的平稳分布总存在.
4. 有限不可约非周期马氏链存在唯一的平稳分布.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.5.7 平稳分布的条件.html" height=600></iframe>
    </details>
</div>
~~**备注**	由证明过程可知, 若存在 $n$ 个基本正常返闭集, 则存在 $ 2^n - 1 $ 个平稳分布.~~

#### 3.5.3  $ \lim\limits_{n\to\infty} \pi_j(n) $ 的存在性

**定义**	若 $ \forall j \in S, \nlim \pi_j(n) = \pi_j^* $ 存在, 则称 $ \bm \pi^* = \Bqty{\pi_1^*, \cdots, \pi_j^*, \cdots} $ 为马氏链的 **极限分布**.

**备注**	即 $ \nlim \bm \pi(0) \bm P^n = \bm \pi^* $, 于是 $ \bm \pi^* = \bm \pi^* \bm P $, 因此极限分布是平稳分布.

**定理 3.5.8**	非周期不可约链是正常返的充要条件是它存在平稳分布, 且此时平稳分布就是极限分布.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.5.8 非周期不可约链正常返的条件.html" height=430></iframe>
    </details>
</div>
**备注**	不可约遍历链的极限分布是平稳分布, 且当 $ n $ 充分大时,
$$
P\Bqty{X_n = j} \approx \pi_j = \dfrac{1}{\mu_j}.
$$

---

**例 1**	设 $ S = \Bqty{1, 2}, \bm P = \begin{bmatrix}
	\frac{3}{4} & \frac{1}{4} \\
	\frac{5}{8} & \frac{3}{8}
\end{bmatrix} $, 求其平稳分布与极限分布 $ \nlim \bm P^n $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>例
        </b></summary>
        <iframe src="ifsrc\3.5.8 例 1 求极限分布.html" height=200></iframe>
    </details>
</div>
**例 2**	设 $ \Bqty{X_n, n \ge 0} $ 为[艾伦费斯特链](# 4  艾伦费斯特模型), 不过 $ S = \Bqty{0, 1, 2, \cdots, 2N} $, 转移概率为
$$
\begin{cases}
	p_{ii} = 0, & 0 \le i \le 2 N, \\
	p_{i, i + 1} = \dfrac{2N-i}{2N}, & 0 \le i \le 2N - 1, \\
	p_{i, i - 1} = \dfrac{i}{2N}, & 1 \le i \le 2N.
\end{cases}
$$
求此链的 $ \pi_j $ 与 $ \mu_j $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>例
        </b></summary>
        <iframe src="ifsrc\3.5.9 例 2 艾伦费斯特链.html" height=280></iframe>
    </details>
</div>

#### 3.5.4  求和或积分与极限交换

**定理 3.5.9 (Levy 单调收敛定理)**	设行向量 $ \bm \pi $ 的分量非负, 若列向量序列
$$
\Bqty{
	\bm f^{(n)} = \pqty{
		\soneto{f^{(n)}}{i}, \cdots
	}\trans
}
$$
满足 $ 0 \le \bm f^{(1)} \le \cdots \le \bm f^{(n)} \le \cdots $, 且 $ \nlim \bm f^{(n)} = \bm f $, 则 $ \bm \pi \bm f = \nlim \bm \pi \bm f^{(n)} $, 即
$$
\sum_{i \in S} \pi_i \nlim f_i^{(n)}
= \nlim \sum_{i \in S} \pi_i f_i^{(n)}.
$$
**定理 3.5.10 (Fatou 定理)**	设行向量 $ \bm \pi $ 的分量非负, 若列向量序列 $ \Bqty{\bm f^{(n)}} $ 满足
$$
\bm \pi \nlim \inf \bm f^{(n)}
\le \nlim \inf \bm \pi \bm f^{(n)},
$$
且 $ \nlim \bm f^{(n)} \equiv \bm f $ 存在, 则
$$
\bm \pi \bm f \le \nlim \inf \pi \bm f^{(n)}.
$$
**定理 3.5.11 (Lebesgue 控制收敛定理)**	设行向量 $ \bm \pi $ 的分量非负, 若列向量序列 $ \Bqty{\bm f^{(n)} \ge 0} $ 满足
$$
\vqty{\bm f^{(n)}} = \pqty{
	\vqty{f_1^{(n)}}, \vqty{f_2^{(n)}}, \cdots
}\trans \le \pqty{c, c, \cdots}\trans,
$$
其中 $ c > 0 $ 为常数, 且 $ \nlim \bm f^{(n)} \equiv \bm f $ 存在, 则
$$
\bm \pi \bm f = \nlim \bm \pi \bm f^{(n)}.
$$



### 3.6  离散时间的 Phase-Type 分布

#### 3.6.1  Phase-Type 分布与记号

**定义**	设 $ \Bqty{X_n, n \ge 0} $ 是马氏链 (M.C.),

1. 状态空间 $ \wt S = S \cup S_0 $, 其中
   1. $ S = \Bqty{1, 2, \cdots, p} $ 为瞬时态集 (非常返态集),
   2. $ S_0 = 0 $ 为吸收态 (常返闭集).

2. 一步转移概率矩阵 $ \wt{\bm P} = \begin{bmatrix} \bm P & \bm P_0 \\ \bm 0 & 1 \end{bmatrix} $, 其中
   1. $ \bm P $ 为瞬时态集的转移矩阵,
   2. $ \bm P_0 = (\bm I - \bm P) \bm e $, 其中
   3. $ \bm e = (1, 1, \cdots, 1)\trans $.

3. 记从瞬时态集到吸收态集的首达时间为 $ \tau = \inf\Bqty{n : n > 0, X_n \in S_0} $.

则称 $ \tau $ 的分布为 **Phase-Type 分布**, 简称 **PH 分布**.

**记号**

- $ \pi(0) = (\alpha_0, \bm \alpha) $, 其中 $ \bm \alpha = (\alpha_1, \cdots, \alpha_p) $, $ \alpha_k \ge 0 $, $ \dsum_{k \in S} \alpha_k = 1 $.
- $ g_k = P\Bqty{\tau = k} $, $ g_k(i) = P\Bqty{\tau = k \mid X_0 = i} $, $ \bm g_k = \pqty{g_k(i), i \in S}\trans $,
- $ g(\lambda) = E(\lambda^\tau) %= \dsum_{k=0}^\infty g_k \lambda^k $, $ g(i, \lambda) = E\Bqty{\lambda^\tau \mid X_0 = i} $, $ \bm g(\lambda) = \pqty{g(i, \lambda), i \in S} $.

#### 3.6.2  概率分布及其母函数

**引理**	若矩阵 $ \bm Q $ 满足 $ \nlim \bm Q^n = \bm 0 $, 则 $ (\bm I - \bm Q)\inv $ 存在, 且
$$
(\bm I - \bm Q)\inv = \sum_{k=0}^\infty \bm Q^k.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.6.1 线性代数引理.html" height=350></iframe>
    </details>
</div>
**推论**	设 $ \Bqty{S = 1, 2, \cdots, m} $ 有限, 令 $ p_{ij}^{(0)} = I_\Bqty{i = j} $, 定义转移概率母函数 $ \phi_{ij}(z) = \nosum p_{ij}^{(n)} z^n $, 其中 $ \vqty{z} < 1 $ 且 $ i, j \in S $, 母函数矩阵 $ \bm \Phi(z) = (\phi_{ij}(z)) $, 则
$$
\bm \Phi(z) = (\bm I - z \bm P)\inv = \bm I + z \bm P + z^2 \bm P^2 + \cdots + z^n \bm P^n + \cdots.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.6.1 引理的推论.html" height=280></iframe>
    </details>
</div>
**定理 3.6.1**	

1. $ g_k = \begin{cases}
   	\alpha_0, & k = 0, \\
   	\bm \alpha \bm P^{k-1} \bm P_0, & k \ge 1.
   \end{cases} $ 
2. $ \bm g_k = \begin{cases}
   	\bm e, & k = 0, \\
   	\bm P^{k-1} \bm P_0, & k \ge 1.
   \end{cases} $ 
3. $ g(\lambda) = \alpha_0 + \lambda \bm \alpha (\bm I - \lambda \bm P)\inv \bm P_0 $.
4. $ \bm g(\lambda) = \bm e + \lambda (\bm I - \lambda \bm P)\inv \bm P_0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.6.1 概率分布与母函数.html" height=550></iframe>
    </details>
</div>

#### 3.6.3  PH 分布的反问题

**定理 3.6.2**	记 $ \bm B(k, p) = (\bm g_k, \bm g_{k+1}, \cdots, \bm g_{k+p-1}) $ 为 $ p \cp p $ 矩阵, 称之为该马氏链首达时间 $ \tau $ 的条件分布向量矩阵, 则

1. 对于 $ \forall k \in \N^+ $, 有

$$
\begin{align}
\bm g_k &= \bm P \bm g_{k-1}, \\
\bm B(k, p) &= \bm P \cdot \bm B(k-1, p).
\end{align}
$$

2. 若 $ \rank \bm B(0, p) = p $, 则

$$
\begin{align}
\bm P &= \bm B(1, p) \bm B\inv(0, p), \\
\bm P_0 &= (\bm I - \bm B(1, p)) \bm B\inv(0, p) \bm e.
\end{align}
$$

3. 若 $ \rank \bm B(0, p) = p $, 则

$$
\bm g_k = \bm B(1, p) \bm B\inv(0, p) \bm g_{k-1}.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.6.2 PH 分布的反问题.html" height=135></iframe>
    </details>
</div>

**备注**	若 $ \rank \bm B(0, p) = 0 $, 则 $ \tau $ 的条件分布向量序列和 $ \bm P, \bm P_0 $ 均由 $ \bm B(1, p) $ 唯一确定.$ %问题待做. :star: $

#### 3.6.4  PH 分布的性质

**性质 1**	若 $ \tau_1, \tau_2 $ 为 PH 分布, 则 $ \tau_1 + \tau_2, \tau_1 \and \tau_2, \tau_1 \or \tau_2 $ 均为 PH 分布.

**性质 2**	若离散型随机变量 $ \xi $ 与 PH 分布 $ \tau_1, \cdots, \tau_n $ 独立, 且 $ P\Bqty{\xi = k} = p_k, 1 \le k \le n $, 则 $ \knsum \tau_k I_\Bqty{\xi = k} $ 为 PH 分布.

**性质 3**	设 PH 分布 $ \tau $ 的分布函数为 $F$, 则
$$
\forall r \in (0, 1) \colon
\nosum (1 - r) r^{n - 1} F^{*n}
$$
为 PH 分布, 其中 $ F^{*n} $ 表示 $n$ 重卷积.



### 3.7  首达目标模型及其他模型

#### 3.7.1  首达目标模型的定义

**定义**	对于定义在有限集状态空间 $S$ 上的马氏链 $ \Bqty{X_n, n \ge 0} $,

1. 设 $ H \subset S $ 为目标集, $ \overline{H} = S - H $ 为工作集.

2. 定义在 $S$ 上的函数 $ r(i) \equiv r_i \in (0, +\infty) $ 称为系统在 $ i $ 状态的单位时段报酬 (或性能指标函数), 并规定 $ \forall i \in H: r(i) = 0 $.

3. 记首达目标集的时间为
   $$
   \tau_H = \begin{cases}
   	\min\Bqty{n : n \ge 0, X_n \in H}, &
   	\Bqty{n : n \ge 0, X_n \in H} \ne \varnothing, \\
   	\infty, & \Bqty{n : n \ge 0, X_n \in H} = \varnothing.
   \end{cases}
   $$

4. 记从 0 时刻和 1 时刻进入目标集之前的总报酬 (或性能指标) 为
   $$
   W_0 = \sum_{n = 0}^{\tau_H} r(X_n), \quad
   W_1 = \sum_{n = 1}^{\tau_H} r(X_n).
   $$
   于是 $ W_0 $ 是定义于 $ \Bqty{X_n, n \ge 0} $ 上的可加泛函, 且 $ W_0 $ 和 $ W_1 $ 都是非负随机变量.

5. 原点矩、分布函数、矩母函数
   $$
   \begin{align}
   \mu_i^{(k)} &= E\Bqty{W_0^k \mid X_0 = i}, \quad k \ge 0, i \in \overline H.
   \\
   F_i(t) &= P\Bqty{W_0 \le t \mid X_0 = i}, \quad t \ge 0, i \in \overline H.
   \\
   \phi_i(\lambda) &= \intoi \e^{-\lambda t} \dd{F_i(t)}, \quad \lambda \ge 0, i \in \overline H.
   \\
   r_i^{(k)} &= \begin{cases}
   	1, & k = 0, \\
   	\dsum_{l=0}^{k-1} (-1)^{k-1-l} \binom{k}{l} r_i^{k-l} \mu_i^{(l)}, & k \ge 1.
   \end{cases}
   \end{align}
   $$
   并令 $ \bm r^{(k)}, \bm \mu^{(k)}, \bm \phi(\lambda) $ 分别为 $ r_i^{(k)}, \mu_i^{(k)}, \phi_i(\lambda)\ (i \in \overline H) $ 的列向量. 于是 $ r_i^{(k)} = r_i $.

#### 3.7.2  总报酬的期望与方程

**定理 3.7.1**	记 $ \bm P = (p_{ij})_{\overline H \cp \overline H}, i, j \in \overline H $, 则
$$
\forall k \in \N^+: \bm \mu^{(k)} = \bm r^{(k)} + \bm P \bm \mu^{(k)}.
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.7.1 矩的方程.html" height=470></iframe>
    </details>
</div>
**定理 3.7.2**	设 $ \bm Y = (\soneto{y}{p})\trans $ 为 $ \overline{H} $ 上的未知列向量, 则 $ \bm \mu^{(k)}\ (k \ge 1) $ 是
$$
\bm Y = \bm r^{(k)} + \bm P \bm Y
$$
唯一非负有界解, 且
$$
\bm \mu^{(k)} = \nosum \bm P^{(n)} \bm r^{(k)}.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.7.2 唯一解与矩的表达式.html" height=380></iframe>
    </details>
</div>

**推论 1**	记 $ \norm{\mu^{(1)}} = \max_i \vqty{\mu_i^{(1)}} $, $ \norm{\bm r} = \max_i \vqty{r_i} $, 则
$$
\norm{\mu^{(1)}} \le \norm{\bm r}.
$$
#### 3.7.3  首达时间的矩母函数

**定义**

1. $ \bm P_\lambda = \pqty{p_{ij} \e^{-\lambda r_i}}, i, j \in \overline H $.
2. $ b_i(\lambda) = \dsum_{j \in H} p_{ij} \e^{-\lambda r_i} $.
3. $ \bm b(\lambda) = \pqty{b_1(\lambda), b_2(\lambda), \cdots, b_p(\lambda)}\trans $.

**定理 3.7.3**	对于 $ \forall \lambda \ge 0 $, 矩母函数 $ \phi(\lambda) $ 是方程组
$$
\bm Y = \bm b(\lambda) + \bm P_\lambda \bm Y
$$
唯一的非负有界解.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.7.3 矩母函数的方程.html" height=560></iframe>
    </details>
</div>

**推论**	对于 $ \forall \lambda \ge 0 $, 有
$$
\phi(\lambda) = \nosum \bm P_\lambda^n \bm b(\lambda).
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.7.3 推论-矩母函数的表达式.html" height=60></iframe>
    </details>
</div>
#### 3.7.4  折扣依赖于历史模型

**定义**	对于马氏链 $ X = \Bqty{X_n, n \ge 0} $,

1. 设状态空间 $ S = \Bqty{1, 2, \cdots, m} $ 一步转移概率矩阵为 $ \bm P = (p_{ij}) $.
2. 系统的性能指标为 $ r\colon S \to \R^+ $, 折扣因子为 $ \beta\colon S \to \bpqty{0, 1} $.
3. 记 $ \beta(i) = \e^{-\overline{\beta}(i)} $, 其中 $ \forall i \in S\colon \overline{\beta}(i) > 0 $.
4. 折扣依赖于历史的可加性能泛函为

$$
\begin{cases}
\xi_k = \dsum_{n = k}^\infty \prod_{l = k}^{n-1} \beta(X_l) r(X_n)
\\
\hspace{1.15em} = \dsum_{n = k}^\infty \exp\pqty{
	-\sum_{l=k}^{n-1} \overline\beta(X_l)
} r(X_n),
\\ \\
m_k(i) = E\Bqty{\xi_0^k \mid X_0 = i},
\\
\bm m_k = (m_k(i), i \in S)\trans,
\\ \\
r_k(i) = \begin{cases}
	r(i), & k = 1, \\
	\dsum_{l=0}^{k-1} \binom{k}{l} (-1)^{k + 1 - l} r^{k-l}(i) m_l(i), & k \ge 2.
\end{cases}
\\
\bm r_k = (r_k(i), i \in S)\trans,
\\ \\
p_{ij}(k) = \beta^k(i) p_{ij},
\\
\bm P(k) = (p_{ij}(k))_{i, j \in S}.
\end{cases}
$$

并约定 $ \prod_{l=0}^{-1} \beta(X_l) = 1 $.

#### 3.7.5  平均报酬期望的方程

**定理 3.7.4**	对于 $ \forall k \ge 1 $, 有
$$
\bm m_k = \bm r_k + \bm P(k) \bm m_k.
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.7.4 平均报酬期望的方程.html" height=455></iframe>
    </details>
</div>

**推论**	$ \bm m_k $ 是下列非负方程
$$
\bm X = \bm r_k + \bm P(k) \bm X
$$
的唯一非负最小解, 且
$$
\bm m_k = \nosum \bm P^n(k) \bm r_k.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.7.4 推论-唯一非负最小解.html" height=300></iframe>
    </details>
</div>
**定理 3.7.5**	对于上述马氏链折扣依赖于历史模型的 $ k $ 阶矩向量 $ \bm m_k $, 必可构造一相应的首达目标模型, 使得该模型的一阶矩向量恰好等于 $ \bm m_k $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\3.7.5 矩相等的首达目标模型.html" height=600></iframe>
    </details>
</div>


