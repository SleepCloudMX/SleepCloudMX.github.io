<h1 align="center">离散鞅引论</h1>

$$
% 设置
\newcommand{\aneg}[1]{\hspace{-0.75em}&#1&\hspace{-0.75em}}
\newcommand{\aneq}{\aneg{=}}
% 上述指令用于在使用 array 环境时调整等号左右间距
\newcommand{\eqs}{\quad\;}
% 上述指令用于 align 环境中, &= 的换行对齐时调整第二行位置
\renewcommand{\d}{\displaystyle}

% 字符
\renewcommand{\i}{\mathrm{i}}
\renewcommand{\j}{\mathrm{j}}
\renewcommand{\k}{\mathrm{k}}
\newcommand{\e}{\textup{e}}
\newcommand{\ve}{\varepsilon}
\newcommand{\Beta}{\mathrm{B}}
\newcommand{\omicron}{\mathit{o}}
\newcommand{\Omicron}{\mathit{O}}

% 原本的定义为:
% \newcommand{\cal}[1]{\mathcal{#1}}
\newcommand{\bm}[1]{\boldsymbol{#1}}
\renewcommand{\cal}[1]{\mathcal#1}
\renewcommand{\scr}[1]{\mathscr#1}
\renewcommand{\frak}[1]{\mathfrak#1}
\newcommand{\bb}[1]{\mathbb#1}

% 数集
\newcommand{\D}{\mathbb{D}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\J}{\mathbb{J}}
\newcommand{\K}{\mathbb{K}}
\renewcommand{\L}{\mathbb{L}}

% 上下标
\newcommand{\trans}{^\mathrm{T}}
\newcommand{\inv}{^{-1}}
\newcommand{\madj}[1]{^{\pqty{#1^*}}}	% m 重伴随矩阵
\newcommand{\adj}{^*}
\newcommand{\vector}[1]{\overrightarrow{#1}}
\newcommand{\wavy}[1]{\overset\sim#1}	% \tilde 或 \widetilde 不明显, 容易与 \bar 或 \overline 混淆

% 序列
\newcommand{\ccdots}{\cdot\cdots\cdot}
\newcommand{\oneton}{1,2,\cdots,n}
\newcommand{\oneto}[1]{1,2,\cdots,#1}

\newcommand{\ssto}[3]{#1_1 #3 #1_2 #3 \cdots #3 #1_{#2}}
\newcommand{\ssup}[3]{#1^1 #3 #1^2 #3 \cdots #3 #1^{#2}}
\newcommand{\soneto}[2]{\ssto{#1}{#2}{,}}
\newcommand{\splus}[2]{\ssto{#1}{#2}{+}}

% 括号
\newcommand{\aqty}[1]{\expval{#1}}
\newcommand{\pbqty}[1]{\left(#1\right]}
\newcommand{\bpqty}[1]{\left[#1\right)}
\newcommand{\floor}[1]{\left\lfloor#1\right\rfloor}
\newcommand{\ceil}[1]{\left\lceil#1\right\rceil}

% 矩阵宏简写
\newcommand{\bmatrix}[1]{\begin{bmatrix}#1\end{bmatrix}}
\newcommand{\Bmatrix}[1]{\begin{Bmatrix}#1\end{Bmatrix}}
\newcommand{\vmatrix}[1]{\begin{vmatrix}#1\end{vmatrix}}
\newcommand{\Vmatrix}[1]{\begin{Vmatrix}#1\end{Vmatrix}}

% 常用微分
\newcommand{\dx}{\dd{x}}
\newcommand{\dy}{\dd{y}}
\newcommand{\dz}{\dd{z}}
\newcommand{\dt}{\dd{t}}
\newcommand{\ds}{\dd{s}}
\newcommand{\dr}{\dd{r}}

% 一般的微分
% 如果只使用 \dd{x}\dd{y} 的话, 中间会有多余的间隔.
\newcommand{\df}{\dd}
\newcommand{\ddf}[2]{\,\mathrm{d}#1\mathrm{d}#2}	% 微分形式 differential form
\newcommand{\dddf}[3]{\,\mathrm{d}#1\mathrm{d}#2\mathrm{d}#3}

% 高阶微分
\newcommand{\dxdy}{\ddf{x}{y}}
\newcommand{\dydz}{\ddf{y}{z}}
\newcommand{\dzdx}{\ddf{z}{x}}
\newcommand{\dudv}{\ddf{u}{v}}
\newcommand{\drdt}{\ddf{r}{\theta}}
\newcommand{\dxdydz}{\dddf{x}{y}{z}}

% 矩阵的宏指令
\newcommand{\pmcmn}[3]{\begin{pmatrix}
	#1_{11} & #1_{12} & \cdots & #1_{1#3} \\
	#1_{21} & #1_{22} & \cdots & #1_{n#3} \\
	\vdots & \vdots && \vdots \\
	#1_{#2 1} & #1_{#2 2} & \cdots & #2_{n#3} \\
\end{pmatrix}}

\newcommand{\pmc}[1]{\pmcmn{#1}{n}{n}}
\newcommand{\pvcn}[2]{\begin{pmatrix}
	#1_1 \\ #1_2 \\ \vdots \\ #1_{#2}
\end{pmatrix}}

\newcommand{\pvc}[1]{\pvcn{#1}{n}}
\newcommand{\pto}{\overset{P}{\to}}

% 函数名
\renewcommand{\char}{\operatorname{char}}	% 由于已存在此命令, 不可使用 DeclareMathOperator
\renewcommand{\r}{\operatorname{r}}
\DeclareMathOperator{\st}{s.t.\,}	% 虽然不是函数名, 但用了这个指令就放这儿了.
\DeclareMathOperator{\diag}{diag}	% 不需要定义太多, 一个文件里用到什么定义什么,
\DeclareMathOperator{\Ker}{Ker}		% 毕竟特殊的函数名太多太多了.
\DeclareMathOperator{\Aut}{Aut}		% 便捷与效率的权衡.
\DeclareMathOperator{\Inn}{Inn}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\SL}{SL}
\DeclareMathOperator{\stab}{stab}
\DeclareMathOperator{\orb}{orb}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\Cov}{Cov}
\DeclareMathOperator{\Corr}{Corr}
\DeclareMathOperator{\rot}{rot}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\Outer}{Outer}
\DeclareMathOperator{\Even}{Even}
\DeclareMathOperator{\Scalar}{Scalar}
\DeclareMathOperator{\Vector}{Vector}
\DeclareMathOperator{\arsh}{arsh}
\DeclareMathOperator{\arch}{arch}
\DeclareMathOperator{\arth}{arth}
\renewcommand{\Re}{\operatorname{Re}}	% 自带 \Re 的效果是 \mathrm{Re}, 前后无空格, 故重写
\renewcommand{\Im}{\operatorname{Im}}
\DeclareMathOperator{\Sa}{Sa}
\DeclareMathOperator{\Si}{Si}

% 运算符
% 可以用 \bigcap, \bigcup, \bigoplus, \bigotimes 替代
\newcommand{\capop}{\displaystyle\mathop\cap\limits}
\newcommand{\cupop}{\displaystyle\mathop\cup\limits}
\newcommand{\oplusop}{\mathop\oplus\limits}
\newcommand{\otimesop}{\mathop\otimes\limits}
\newcommand{\bigoplusop}{\mathop\bigoplus\limits}
\newcommand{\bigotimesop}{\mathop\bigotimes\limits}

% 积分
\newcommand{\dint}{\displaystyle\int}
\newcommand{\inti}{\dint_{-\infty}^{+\infty}}
\newcommand{\intoi}{\dint_0^{+\infty}}

\newcommand{\intl}{\displaystyle\int\limits}
\newcommand{\iintl}{\displaystyle\iint\limits}
\newcommand{\iiintl}{\displaystyle\iiint\limits}

% 求和
\newcommand{\dsum}{\displaystyle\sum}
\newcommand{\csum}[1]{\dsum_{#1=1}^\infty}
\newcommand{\nsum}{\csum{n}}
\newcommand{\ksum}{\csum{k}}
\newcommand{\nosum}{\dsum_{n=0}^\infty}
\newcommand{\insum}{\dsum_{i=1}^n}
\newcommand{\knsum}{\dsum_{k=1}^n}

% 求积
\newcommand{\dprod}{\displaystyle\prod}
\newcommand{\nprod}{\dprod_{n=1}^\infty}
\newcommand{\noprod}{\dprod_{n=0}^\infty}
\newcommand{\inprod}{\dprod_{i=1}^n}

% 极限
\newcommand{\liml}{\lim\limits}
\newcommand{\ulim}{\overline\lim\limits_{n\to\infty}}
\newcommand{\dlim}{\underline\lim\limits_{n\to\infty}}
% 注意这里的 d 是 down, 而不是 displaystyle

\newcommand{\xlim}{\lim\limits_{x\to x_0}}
\newcommand{\nlim}{\lim\limits_{n\to\infty}}
\newcommand{\clim}[1]{\lim\limits_{#1\to\infty}}

% 并集
\newcommand{\incup}{\bigcup_{i=1}^n}
\newcommand{\ncup}{\bigcup_{n=1}^\infty}
\newcommand{\icup}{\bigcup_{i=1}^\infty}

% 交集
\newcommand{\incap}{\bigcap_{i=1}^n}
\newcommand{\ncap}{\bigcap_{n=1}^\infty}
\newcommand{\icap}{\bigcap_{i=1}^\infty}

% 差分
\newcommand{\DD}{\Delta}
\newcommand{\DV}[2]{\dfrac{\DD#1}{\DD#2}}
\newcommand{\nDV}[3]{\dfrac{\DD^{#1}#2}{\DD#3^{#1}}}

% 求导
\newcommand{\ddv}{\displaystyle\dv}
\newcommand{\dpdv}{\displaystyle\pdv}

% 缩写
\newcommand{\LRA}{\Leftrightarrow}
\newcommand{\RLA}{\Leftrightarrow}
\newcommand{\LA}{\Leftarrow}
\newcommand{\RA}{\Rightarrow}

\newcommand{\lra}{\leftrightarrow}
\newcommand{\rla}{\leftrightarrow}
\newcommand{\la}{\leftarrow}
\newcommand{\ra}{\rightarrow}

\newcommand{\QRLA}{\quad\RLA\quad}
\newcommand{\QRA}{\quad\RA\quad}
\newcommand{\LLRA}{\Longleftrightarrow}

\newcommand{\QNRA}{\quad\nRightarrow\quad}
\newcommand{\qnra}{\quad\nrightarrow\quad}

\newcommand{\wt}{\widetilde}

% 图形符号
\newcommand{\qed}{\quad\square}
\renewcommand{\parallel}{\mathrel{/\mskip-2.5mu/}}
\newcommand{\paralleleq}{\hspace{0.5em}{^{^{\parallel}}}\hspace{-1.04em}=}
\newcommand{\rt}{\matrm{Rt}\triangle}

% 分块矩阵
\newenvironment{mat}[1]{
	\begin{array}{#1}
}{
	\end{array}
}

\newenvironment{pmat}[1]{
	\left( \begin{array}{#1}
}{
	\end{array} \right)
}

\newenvironment{bmat}[1]{
	\left[ \begin{array}{#1}
}{
	\end{array} \right]
}

\newenvironment{Bmat}[1]{
	\left\{ \begin{array}{#1}
}{
	\end{array} \right\}
}

\newenvironment{vmat}[1]{
	\left\lvert \begin{array}{#1}
}{
	\end{array} \right\rvert
}

\newenvironment{Vmat}[1]{
	\left\lVert \begin{array}{#1}
}{
	\end{array} \right\rVert
}
$$

[TOC]

### 4.1  鞅的定义与例子

#### 4.1.1  定义与基本性质

**约定**	

1. 用 a.e. (almost everywhere) 表示命题几乎处处成立, 即不成立的点的测度为 0
2. 用 a.s. (almost sure) 表示命题以概率 1 成立.

**定义**	随机过程 $ \Bqty{X_n, n \ge 0} $ 是 **鞅**, 如果对于 $ \forall n \ge 0 $, 有

1. $ E\vqty{X_n} < \infty $.
1. $ E\pqty{X_{n+1} \mid X_0, X_1, \cdots, X_n} = X_n $, a.s..

**定义**	设有二过程 $ \Bqty{X_n, n \ge 0} $ 和 $ \Bqty{Y_n, n \ge 0} $, 称前者关于后者是鞅, 如果

1. $ E\vqty{X_n} < \infty $.
2. $ E(X_{n + 1} \mid Y_0, Y_1, \cdots, Y_n) = X_n $, a.s..

**备注**

1. $ X_n = E(X_{n+1} \mid Y_0, \cdots, Y_n) $ 作为 $ (Y_0, \cdots, Y_n) $ 的函数, 在给定 $ (Y_0, \cdots, Y_n) $ 时是定值, 因此 $ E(X_n \mid Y_0, \cdots, Y_n) = X_n $.
2. 于是有 $ E(X_{n+1}) = E[E(X_{n+1} \mid Y_0, \cdots, Y_n)] = E(X_n) = E(X_0) $.

#### 4.1.2  鞅的典型例子

**例 1 (i.i.d. r.v. 之和)**	设 $ Y_0 = 0, \Bqty{Y_n, n \ge 1} $ 独立同分布, $ EY_n = 0, E\vqty{Y_n} < \infty $, 令 $ X_0 = 0 $, 记 $ X_n = \insum Y_i $, 则 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是鞅.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.1.2 例1-独立同分布随机变量之和.html" height=250></iframe>
    </details>
</div>

**例 2 (和的方差)**	设 $ Y_0 = 0, \Bqty{Y_n, n \ge 1} $ 独立同分布, $ EY_n = 0, EY_n^2 = \sigma^2 $, $ X_0 = 0, X_n = \pqty{\knsum Y_k}^2 - n\sigma^2 $, 则 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是鞅.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.1.2 例2-和的方差.html" height=350></iframe>
    </details>
</div>

**例 3 (一般和)**	设 $ \Bqty{Y_n, n \ge 0} $ 为随机序列, $ Z_i = g_i(Y_0, \cdots, Y_i) $, 函数 $ f $ 满足 $ E[f(Z_k)] < \infty  $, 有界实函数 $ a_k(y_0, \cdots, y_{k-1}) $ 满足 $ \vqty{a_k} \le A_k $, 约定 $ E[f(Z_0) \mid Y_{-1}] = E[f(Z_0)] $, 则
$$
\Bqty{
	X_n = \sum_{k=0}^n \pqty{
		f(Z_k) - E[f(Z_k) \mid Y_0, \cdots, Y_{k-1}]
	} a_k(Y_0, \cdots, Y_{k-1}), n \ge 0
}
$$
关于 $ \Bqty{Y_n, n \ge 0} $ 是鞅.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.1.3 一般和.html" height=550></iframe>
    </details>
</div>

**例 4 (马氏链导出的鞅)**

**例 5 (转移概率特征向量导出的鞅)**

**例 6 (分支过程构成的鞅)**

**例 7 (Wald 鞅)**

**例 8 (似然比构成的鞅)**

**例 9 (Doob 鞅过程)**

**例 10 (随机 Radon-Nikodym 导数构成的鞅)**



### 4.2  上下鞅与分解定理

#### 4.2.1  定义与例子

**约定**

1. $ x^- = \min(x, 0) $.
2. $ x^+ = \max(x, 0) $.

**定义**	若随机过程 $ \Bqty{X_n, n \ge 0} $ 和 $ \Bqty{Y_n, n \ge 0} $ 满足

1. $ E(X_n^-) > -\infty $.
2. $ E(X_{n + 1} \mid Y_0, \cdots, Y_n) \le X_n $.
3. $ X_n $ 是 $ Y_0, \cdots, Y_n $ 的函数.

则称 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是 **上鞅**.

**定义**	若随机过程 $ \Bqty{X_n, n \ge 0} $ 和 $ \Bqty{Y_n, n \ge 0} $ 满足

1. $ E(X_n^+) < +\infty $.
2. $ E(X_{n + 1} \mid Y_0, \cdots, Y_n) \ge X_n $.
3. $ X_n $ 是 $ Y_0, \cdots, Y_n $ 的函数.

则称 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是 **下鞅**.

**备注**	由于 $ X_n $ 是 $ Y_0, \cdots, Y_n $ 的函数, 对于上下鞅均有 $ X_n = E(X_n \mid Y_0, \cdots, Y_n) $.

**例 1**	设 $ \Bqty{Y_n, n \ge 0} $ 是马氏链, $ \bm P = (p_{ij}) $, $ f $ 是 $\bm P$ 的有界 **右超正则函数**, 即

1. $ \d\sum_{j \in S} p_{ij} f(j) \le f(i) $.
2. $ \vqty{f(i)} \le M $.

则 $ \Bqty{X_n = f(Y_n), n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是上鞅.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.2.1 例1-右超正则函数.html" height=170></iframe>
    </details>
</div>
#### 4.2.2  上下鞅的性质

**引理 1 (Jensen 不等式)**	若 $ \phi $ 是下凸函数, $X$ 是随机变量, 则
$$
E[\phi(X)] \ge \phi(EX).
$$
**引理 2**	如果 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是鞅, $ \phi $ 是下凸函数, 且 $ \forall n \in \N\colon E[\phi(X_n)^+] < \infty $, 则 $ \Bqty{\phi(X_n), n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是一个下鞅.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.2.1 引理2-凸函数构造下鞅.html" height=140></iframe>
    </details>
</div>

**推论**	若 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是鞅, 且 $ E(X_n^2) < \infty $, 则 $ \Bqty{\vqty{X_n}, n \ge 0} $ 与 $ \Bqty{X_n^2, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是下鞅.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.2.1 推论-由下鞅构造下鞅.html" height=60></iframe>
    </details>
</div>

**性质 1**	若 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是 (上) 鞅, 则
$$
\forall k \in \N\colon
E(X_{n + k} \mid Y_0, \cdots, Y_n) (\le) = X_n.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.2.1 性质1.html" height=240></iframe>
    </details>
</div>

**性质 2**	若 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是 (上) 鞅, 则对 $ 0 \le k \le n $ 有
$$
E(X_n) (\le) = E(X_k) (\le) = E(X_0).
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.2.1 性质2.html" height=140></iframe>
    </details>
</div>

**性质 3**	若 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是 (上) 鞅, $ g = g(Y_0, \cdots, Y_n) \ge 0 $, 则
$$
\forall k \ge 0 \colon E\bqty{
	g(Y_0, \cdots, Y_n) X_{n + k} \mid
	Y_0, \cdots, Y_n
} (\le) = g(Y_0, \cdots, Y_n) X_n.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.2.1 性质3.html" height=120></iframe>
    </details>
</div>

#### 4.2.3  上下鞅分解定理

**定理 4.2.1**	若 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是下鞅, 则唯一存在过程 $ \Bqty{M_n, n \ge 1} $ 与 $ \Bqty{Z_n, n \ge 1} $, 使得

1. $ \Bqty{M_n, n \ge 1} $ 关于 $ \Bqty{Y_n, n \ge 1} $ 是鞅.
2. $ Z_n = Z_n(Y_1, \cdots, Y_{n-1}) $, 且 $ Z_1 = 0, Z_n \le Z_{n + 1}, EZ_n < +\infty $.
3. $ \forall n \in \N^+\colon X_n = M_n + Z_n\ $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.2.1 上下鞅分解定理.html" height=600></iframe>
    </details>
</div>

**推论**	若 $ \Bqty{X_n, n \ge 1} $ 关于 $ \Bqty{Y_n, n \ge 1} $ 是上鞅, 则唯一存在过程 $ \Bqty{M_n, n \ge 1} $ 与 $ \Bqty{Z_n, n \ge 1} $, 使得

1. $ \Bqty{M_n, n \ge 1} $ 关于 $ \Bqty{Y_n, n \ge 1} $ 是鞅.
2. $ Z_n = Z_n(Y_1, \cdots, Y_{n-1}) $, 且 $ Z_1 = 0, Z_n \le Z_{n + 1}, EZ_n < +\infty $.
3. $ \forall n \in \N^+\colon X_n = M_n - Z_n\ $.

#### 4.2.4  序贯决策模型

**定义**	记状态空间 $ S = \Bqty{1, 2, \cdots, p} $ 有限, **行动集** (或 **决策空间**) $ A = \Bqty{a, b, \cdots, l} $ 有限, 每经单位时间观察即使的系统状态 $ i $, 然后从 $A$ 中选取一个行动 $ a $, 并

1. 得到一个报酬 (或能量) $ r(i, a) $.
2. 在现时段状态为 $ i $ 且采取行动为 $ a $ 的条件下, 系统下一时刻转移到状态 $ j $ 的概率为 $ q(j \mid i, a) $.

于是该可控随机动态系统称为 **序贯决策模型**.

**定义**	

1. $ Y_k $ 和 $ \Delta_k $ 分别表示 $ k $ 时段系统的状态和采取的行动.
2. $ h_{n - 1} = \Bqty{i_0, a_0, i_1, a_1, \cdots, i_{n-1}, a_{n-1}} $ 称为 $ n-1 $ 之前的 **历史**.
3. $ a_n = \pi_n(h_{n-1}, i_n) $, 其中 $ \pi_n $ 称为 $ n $ 时刻的 **决策函数**.
4. 决策函数序列 $ \pi = \Bqty{\pi_0, \pi_1, \cdots, \pi_{N - 1}} $ 称为一个 **决策**.
5. 期望总报酬 $ V(\pi, i) = E_\pi \Bqty{\dsum_{k=0}^{N-1} r(Y_k, \Delta_k) \mid Y_0 = i} $.
6. 最优策略 $ \pi^*\colon \forall i \in S\colon V(\pi^*, i) = \max_\pi V(\pi, i) $.
7. $ V_k(i) = \begin{cases}
   	0, & k = N, i \in S,
   	\\
   	\max\limits_{a \in A} \Bqty{
   		r(i, a) + \dsum_{j \in S} q(j \mid i, a) V_{k + 1}(j)
   	}, & 1 \le k < N, i \in S.
   \end{cases} $ 
8. $ X_n = \knsum \Bqty{
   	V_k(Y_k) - E\bqty{
   		V_k(Y_k) \mid
   		Y_0, \Delta_0, \cdots, Y_{k - 1}, \Delta_{k - 1}
   	}
   } $.

**问题**	序贯决策模型的最优决策.

**解**

由 [4.1.2 例 3 (一般和)](# 4.1.2  鞅的典型例子) 知 $ \Bqty{X_n, n \ge 1} $ 关于 $ \Bqty{(Y_n, \Delta_n), n \ge 0} $ 是鞅, 于是
$$
EX_n = EX_1 = 0,
$$
并且
$$
\forall i \in S, a \in A \colon
V_{k - 1}(i) \ge r(i, a) + \sum_{j \in S} q(j \mid i, a) V_k(j),
$$
从而由马氏性得
$$
\begin{align}
V_{k - 1}(Y_{k - 1})
&\ge r(Y_{k-1}, \Delta_{k-1}) + \sum_{j \in S}
q(j \mid Y_{k-1}, \Delta_{k-1}) V_k(j)
\\
&= r(Y_{k-1}, \Delta_{k-1}) + E\Bqty{
	V_k(Y_k) \mid Y_{k-1}, \Delta_{k-1}
} \\
&\ge r(Y_{k-1}, \Delta_{k-1}) + E\Bqty{
	V_k(Y_k) \mid
	Y_0, \Delta_0, \cdots, Y_{k-1}, \Delta({k-1})
},
\end{align}
$$
根据此不等式, 于是有
$$
\begin{align}
0 &= EX_N = E\Bqty{
	\sum_{k = 1}^N \bqty{
		V_k(Y_k) - E\pqty{
			V_k(Y_k) \mid
			Y_0, \Delta_0, \cdots, Y_{k-1}, \Delta_{k-1}
		}
	}
} \\
&\ge E\Bqty{
	\sum_{k=1}^N \bqty{
		V_k(Y_k) + r(Y_{k-1}, \Delta_{k-1}) - V_{k-1}(Y_{k-1})
	}
} \\
&= E\Bqty{
	\sum_{k=0}^{N-1} r(Y_k, \Delta_k) +
	V_N(Y_N) - V_0(Y_0)
},
\end{align}
$$
即
$$
\begin{align}
E(V_0(Y_0)) &\ge E\Bqty{
	\sum_{k=0}^{N-1} r(Y_k, \Delta_k) + V_N(Y_N)
} \\
&\ge E_\pi \Bqty{
	\sum_{k = 0}^{N - 1} r(Y_k, \Delta_k) \mid Y_0
},
\end{align}
$$
令 $ Y_0 = i $, 则有
$$
\forall \pi, i \in S \colon
V_0(i) \ge E_\pi\Bqty{
	\sum_{k = 0}^{N - 1} r(Y_k, \Delta_k) \mid Y_0 = i
} = V(\pi, i),
$$
若选取 $ a_{k-1}^* \in A $, 使得 $ a_{k-1}^*(i) = \pi_{k-1}^*(i_0, a_0^*, \cdots, i_{k-1}) $ 满足上述第 7 点定义, 即
$$
\begin{align}
\forall i \in S \colon
V_{k-1}(i) &= r(i, a_{k-1}^*(i)) + \sum_{j \in S} q(j \mid i, a_{k-1}^*(i)) V_k(j)
\\
&= \max_a \Bqty{
	r(i, a) + \sum_j q(j \mid i, a) V_k(j)
},
\end{align}
$$
则 $ \pi^* = \Bqty{\pi_0^*, \pi_1^*, \cdots, \pi_{N-1}^*} $ 是最优策略.



### 4.3  停时与停时定理

#### 4.3.1  严谨定义与例子

**记号**

1. $ \sigma(X) $ 为由 $X$ [生成的事件 σ 域]([c1-概率论公理化 (sleepcloudmx.github.io)](https://sleepcloudmx.github.io/Math/概统/随机过程/c1-概率论公理化.html#111--可测空间)).
2. $ \cal F_n = \sigma(Y_k, 0 \le k \le n) $.

**定义**	设随机变量 $ T \in \N \cap \Bqty{+\infty} $, 随机序列 $ \Bqty{Y_n, n \ge 0} $, 且 $ \cal F_n = \sigma(Y_k, 0 \le k \le n) $, 若对 $ \forall n \ge 0 $, 有 $ \Bqty{T = n} \in \cal F_n $, 则称 $T$ 是 $ \Bqty{Y_n, n \ge 0} $ 的 **停时** (stopping time) (或马氏时间).

**例子**

- 对于随机过程 $ \Bqty{Y_n, n \ge 0} $, 首达时间 $ T = \min\Bqty{n : Y_n \in A} $ 是停时.
- 对于时齐 Poisson 过程 $ \Bqty{N(t), t \ge 0} $,
  - $ N(t) $ 关于 $ \Bqty{S_n, n \ge 0} $ 不是停时.
  - $ N(t) + 1 $ 关于 $ \Bqty{S_n, n \ge 0} $ 是停时.

#### 4.3.2  鞅的期望与停时

**引理 1**	若 $ \Bqty{X_n, n \ge 0} $ 是 $ \Bqty{Y_n, n \ge 0} $ 的 (上) 鞅, $T$ 是关于 $ \Bqty{Y_n, n \ge 0} $ 的停时, 则
$$
\forall n \ge k\colon
E(X_n \cdot I_\Bqty{T = k}) (\le) = E(X_k \cdot I_\Bqty{T=k}).
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.3.1 引理1.html" height=155></iframe>
    </details>
</div>
**引理 2**	若 $ \Bqty{X_n, n \ge 0} $ 是 $ \Bqty{Y_n, n \ge 0} $ 的 (上) 鞅, $T$ 是关于 $ \Bqty{Y_n, n \ge 0} $ 的停时, 则
$$
\forall n \ge 1\colon
EX_0 (\ge) = EX_{T \and n} (\ge) = EX_n.
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.3.1 引理2.html" height=600></iframe>
    </details>
</div>
**引理 3**	设随机变量 $X$ 满足 $ E\vqty{X} < \infty $, $T$ 是关于 $ \Bqty{Y_n, n \ge 0} $ 的停时, 且 $ P(T < \infty) = 1 $, 则
$$
\begin{align}
& \nlim E(X \cdot I_\Bqty{T > n}) = 0, \\
& \nlim E(X \cdot I_\Bqty{T \le n}) = EX.
\end{align}
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.3.1 引理3.html" height=600></iframe>
    </details>
</div>

**定理 4.3.1**	设 $ \Bqty{X_n, n \ge 0} $ 是鞅, $T$ 是停时, 若 $ P\Bqty{T < \infty} = 1 $, 且 $ E(\sup\limits_{n \ge 0} \vqty{X_{T \and n}}) < \infty $, 则 $ EX_T = EX_0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.3.1 鞅的期望与停时.html" height=600></iframe>
    </details>
</div>

**推论**	设 $ \Bqty{X_n, n \ge 0} $ 是鞅, $T$ 是停时, 且 $ ET < \infty $. 若
$$
\exist b < \infty, \forall n < T\colon
E\pqty{
	\vqty{X_{n + 1} - X_n} \mid Y_0, \cdots, Y_n
} \le b,
$$
则 $ EX_0 = EX_T $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.3.1 推论.html" height=600></iframe>
    </details>
</div>
#### 4.3.3  停时定理与推论

**定理 4.3.2 (停时定理)**	设 $ \Bqty{X_n, n \ge 0} $ 是鞅, $T$ 是停时, 若

1. $ P(T < \infty) = 1 $.
2. $ E\vqty{X_T} < \infty $.
3. $ \nlim E\vqty{X_n I_\Bqty{T > n}} = 0 $.

则 $ EX_T = EX_0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.3.2 停时定理.html" height=340></iframe>
    </details>
</div>
**推论 1**	设 $ \Bqty{X_n, n \ge 0} $ 是鞅, $T$ 是停时, 若

1. $ P\Bqty{T < \infty} = 1 $.
2. $ \exist k < \infty, \forall n \ge 0\colon E(X^2_{T \and n}) \le k $.

则 $ EX_T = EX_0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.3.2 推论1.html" height=600></iframe>
    </details>
</div>

**推论 2**	若

1. $ Y_0 = 0 $, $ \Bqty{Y_k, k \ge 1} $ 独立同分布.
2. $ EY_k = \mu, DY_k = \sigma^2 < \infty $.
3. $ S_0 = 0, S_n = \knsum Y_k, X_n = S_n - n \mu $.
4. $T$ 为停时, $ ET < \infty $.

则 $ E\vqty{X_T} < \infty $, 且 $ EX_T = ES_T - \mu ET = 0 $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.3.2 推论2.html" height=600></iframe>
    </details>
</div>

#### 4.3.4  停时与随机游动

**记号**	

1. $ Y_0 = 0, \Bqty{Y_k, k \ge 1} $ 独立同分布, 且

   $ P\Bqty{Y_k = 1} = p \ge 0 $, $ P\Bqty{Y_k = -1} = q = 1 - p \ge 0 $.

2. $ X_0 = 0, X_n = \knsum Y_k $.

3. $ T_{0j} = \min\Bqty{n\colon X_0 = 0, X_n = j} $.

4. $ T = \min\Bqty{n\colon (X_n = a) \or (X_n = b)}, b \in \N^+, a \in \Z \backslash \N $.

5. $ \sideset{_b}{_a}{T} = \min\Bqty{n \colon X_0 = 0, X_l \ne b, 1 \le l \le n - 1, X_n = a} $.

6. $ V_a = P\Bqty{\sideset{_b}{_a}{T} < \infty \mid X_0 = 0} $ 表示从 0 出发先到达 $a$ 的概率.

   于是 $ P\Bqty{\sideset{_a}{_b}T < \infty \mid X_0 = 0} = 1 - V_a $.

**实例**	设甲乙两人赌博, $ \vqty{a} $ 表示甲原有的资金 (注意 $a$ 为负数), $ Y_n $ 表示甲第 $n$ 次得到的钱, $b$ 表示乙原有的资金, $ V_a $ 表示甲先输光的概率.

**情况 1**	当 $ p = q = \dfrac{1}{2} $ 时, 即公平赌博时,

1. 甲先输光的概率为 $ V_a = \dfrac{b}{\vqty{a} + b} $,
2. 任何一方输光的平均时间为 $ ET = \vqty{a} b $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.3.4 停时与随机游动-情况1.html" height=600></iframe>
    </details>
</div>
**情况 2**	当 $ \mu = p - q > 0 $ 时, 即不公平赌博时,

1. 甲先输光的概率为 $ V_a = \dfrac{
   	1 - \pqty{\cfrac{q}{p}}^b
   }{
   	\pqty{\cfrac{q}{p}}^a -
   	\pqty{\cfrac{q}{p}}^b
   } $.
2. 任何一方输光的平均时间为 $ ET = \dfrac{
   	a - b + b\pqty{\cfrac{q}{p}}^a - a\pqty{\cfrac{q}{p}}^b
   }{
   	(p - q) \bqty{
   		\pqty{\cfrac{q}{p}}^a -
   		\pqty{\cfrac{q}{p}}^b
   	}
   } $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.3.4 停时与随机游动-情况2.html" height=600></iframe>
    </details>
</div>


### 4.4  鞅收敛定理

#### 4.4.1  上穿不等式

**引理 1**	设 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是下鞅, $S$, $T$ 关于 $ \Bqty{Y_n} $ 是停时, 且 $ 0 \le S \le T \le N $, 则
$$
EX_S \le EX_T.
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.4.1 引理1.html" height=600></iframe>
    </details>
</div>

**定义**	设 $ \Bqty{X_n} $ 是随机序列, 令

1. $ V^{(n)}(a, b)(\omega) $ 是 $ \Bqty{X_0(\omega), X_1(\omega), \cdots, X_n(\omega)} $ 向上穿越 $ (a, b) $ 的次数.
2. 若干次首达 $ \pbqty{-\infty, a} $ 和 $ \bpqty{b, +\infty} $ 的时间为

$$
\alpha_m = \begin{cases}
	0, & m = 0, \\
	\min\Bqty{
		n \colon n \ge \alpha_{m - 1}, X_n \le a
	}, & m = 2k - 1, k \in \N^+, \\
	\min\Bqty{
		n \colon n > \alpha_{m - 1}, X_n \ge b
	}, & m = 2k, k \in \N^+.
\end{cases}
$$

3. $ a^+ \equiv a \or 0 \equiv \max(a, 0) $.

**备注**	$ V^{(n)}(a, b)(\omega) = k \RLA \exist k \in \N^+ \colon \alpha_{2k} \le n < \alpha_{2k + 2} $.

**引理 2 (上穿不等式)**	设 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是下鞅, 则
$$
E\bqty{
	V^{(n)}(a, b)
} \le \dfrac{
	E\bqty{(X_n - a)^+} -
	E\bqty{(X_0 - a)^+}
}{b - a} \le \dfrac{
	E\pqty{X_n^+} + \vqty{a}
}{b - a}.
$$

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.4.1 引理2-上穿不等式.html" height=600></iframe>
    </details>
</div>


**推论**	若 $ \Bqty{X_n, n \ge 0} $ 关于 $ \Bqty{Y_n, n \ge 0} $ 是上鞅, $ \overline V^{(n)}(a, b) $ 是 $ X_n $ 下穿 $ (a, b) $ 的次数, 则
$$
E\bqty{
	\overline V^{(n)}(a, b)
} \le \dfrac{
	E(b \and X_0) - E(X_n \and b)
}{b - a},
$$
如果 $ X_n \ge 0, 0 \le a < b $, 则
$$
E\bqty{
	\overline V^{(n)}(a, b)
} \le \dfrac{b}{b - a}.
$$
#### 4.4.2  鞅收敛定理

**定理 4.4.1**	设 $ \Bqty{X_n, n \ge 0} $ 是一个下鞅, 且 $ \sup_n E\vqty{X_n} < \infty $, 则存在一随机变量 $ X_\infty $, 使得 $ \Bqty{X_n} $ 以概率 1 收敛于 $ X_\infty $, 即
$$
P\Bqty{\nlim X_n = X_\infty} = 1,
$$
且 $ E\vqty{X_\infty} < \infty $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.4.1 鞅收敛定理.html" height=600></iframe>
    </details>
</div>

#### 4.4.3  最大值不等式

**引理 1 (Kolmogorov 不等式)**	设 $ \Bqty{X_n} $ 独立且 $ \forall i \in \N \colon E\vqty{X_i} < +\infty $, 令 $ S_n = \insum X_i $, 则
$$
\forall \ve > 0 \colon P\Bqty{
	\max_{1 \le k \le n} \vqty{S_k - ES_k} \ge \ve
} \le \dfrac{DS_n}{\ve^2}.
$$
[**证明**](https://zhuanlan.zhihu.com/p/69607174)	

**推论 1 (Chebyshev 不等式)**	设 $ EX^2 < +\infty $, 则
$$
\forall \ve > 0 \colon
P\Bqty{
	\vqty{X - EX} \ge \ve
} \le \dfrac{DX}{\ve^2}.
$$
**推论 2 (最大值不等式)**	设 $ \Bqty{Y_n, n \ge 0} $ 独立同分布, 且 $ EY_i = 0, EY_i^2 = \sigma^2\ (i \ge 0) $, $ X_0 = 0, X_n = \insum Y_i $, 则
$$
\forall \ve > 0 \colon
P\Bqty{
	\max_{0 \le k \le n} \vqty{X_k} > \ve
} \le \dfrac{n\sigma^2}{\ve^2}.
$$

#### 4.4.4  另一收敛定理

**引理 2**	设 $ \Bqty{X_n \ge 0, n \ge 0} $ 是下鞅, 则
$$
\forall \lambda > 0 \colon
\lambda P\Bqty{
	\max_{0 \le k \le n} X_k > \lambda
} \le EX_n.
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.4.2 引理2.html" height=300></iframe>
    </details>
</div>

**推论 1 (Markov 不等式)**	设 $ Y \ge 0 $, 则
$$
\forall \ve > 0 \colon
P\Bqty{X \ge \ve} \le \dfrac{EX}{\ve}.
$$
**推论 2**	设 $ \Bqty{X_n, n \ge 0} $ 是鞅, 则
$$
\forall \lambda > 0 \colon
\lambda P\Bqty{
	\max_{0 \le k \le n} \vqty{X_k} > \lambda
} \le E\vqty{X_n}.
$$
<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.4.2 引理2-推论2.html" height=180></iframe>
    </details>
</div>

**定理 4.4.2**	设 $ \Bqty{X_n} $ 关于 $ \Bqty{Y_n} $ 是鞅, 且 $ \exist k, \forall n \in \N\colon EX_n^2 \le k < \infty $, 则存在一有限随机变量 $ X_\infty $, 使得

1. $ P\Bqty{
   	\nlim X_n = X_\infty
   } = 1 $.
2. $ \nlim E\vqty{X_n - X_\infty}^2 = 0 $.
3. $ \forall n \in \N \colon EX_n = EX_\infty $.

**证明**	略.



### 4.5  连续参数鞅

**定义**	设 $ \Bqty{X(t), t \ge 0} $ 是一随机过程, 记 $ \cal F_t = \sigma(X(s), 0 \le s \le t) $, 若满足下述条件

1. $ \forall t \ge 0 \colon E\vqty{X(t)} < \infty $.
2. $ \forall s, t \ge 0 \colon E\bqty{X(t + s) \mid \cal F_t} = X(t) $, a.s..
3. $ \forall t \ge 0 \colon X(t) $ 关于 $ \cal F $ 是可测的. (参考[笔记](https://sleepcloudmx.github.io/Math/概统/随机过程/c1-概率论公理化.html)).

则过程 $ \Bqty{X(t), t \ge 0} $ 称为 **鞅**.

**定义 (离散化等价定义)**	随机过程 $ \Bqty{X(t), t \ge 0} $ 称为 **鞅**, 如果满足

1. $ \forall t \ge 0 \colon E\vqty{X(t)} < \infty $.
2. $ \forall 0 \le t_0 < \cdots < t_{n + 1} \colon E\bqty{X(t_{n + 1}) \mid X(t_1), \cdots, X(t_n)} = X(t_n) $, a.s..

**备注**	连续参数的上下鞅类似定义.

**定义**	设随机序列 $ \Bqty{X(t), t \ge 0} $ 和非负随机变量 $ T $, 记 $ \cal F_t = \sigma(X(s), 0 \le s \le t) $, 若
$$
\forall t \ge 0 \colon \Bqty{T \le t} \in \cal F_t,
$$
则称 $T$ 是 $ \Bqty{X(t), t \ge 0} $ 的 **停时**.

**定理 4.5.1 (停时定理)**	设 $ \Bqty{X(t), t \ge 0} $ 是鞅, $T$ 是停时, 若

1. $ P\Bqty{T < \infty} = 1 $.
2. $ E\pqty{\sup_{t \ge 0} \vqty{X\pqty{T \and t}}} < \infty $.

则 $ EX(T) = EX(0) $.

<div style="background-color: #f3f2ee">
    <details>
        <summary><b>证明</b>
        </summary>
        <iframe src="ifsrc\4.5.1 连续参数鞅停时定理.html" height=180></iframe>
    </details>
</div>

